# QPDS - Quantitative Poker Decision System
## 量化扑克决策系统

[![Python 3.8+](https://img.shields.io/badge/python-3.8+-blue.svg)](https://www.python.org/downloads/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

QPDS 将量化投资的理性思维引入德州扑克决策制定。系统实时整理底牌、公共牌、底池与筹码信息，基于多因子模型计算关键指标，为玩家提供数据驱动的行动建议和详细解释。前端提供直观的双语交互界面，后端采用 Flask 架构，核心算法模块化设计，便于扩展与复用。

## 🎯 项目亮点
- **直观交互界面**：浏览器内直接操作，选择牌面、调整底池筹码与风险偏好，实时查看输入摘要
- **智能决策引擎**：整合胜率、底池赔率、SPR、听牌概率与位置等多维度指标，输出包含置信度的推荐行动
- **完整双语支持**：界面、提示与错误信息支持中英文无缝切换
- **模块化架构**：`backend/core` 分离评估器、因子计算、决策引擎等组件，支持独立调用和测试
- **一键启动脚本**：`run.py` 自动管理虚拟环境、依赖安装和服务启动，开箱即用

## 🏗️ 系统结构
```text
QPDS/
├── backend/
│   ├── api/                 # Flask 入口与路由
│   ├── core/                # 牌力评估、权益计算、因子/决策引擎
│   ├── models/              # 结构体与序列化模型
│   ├── utils/               # 辅助函数与工具
│   └── config/              # 配置与常量
├── frontend/
│   ├── index.html           # 纯 HTML/JS 前端界面
│   └── package.json         # 未来重构 Vue/Vite 的占位配置
├── data/                    # 示例数据与手牌记录
├── docs/                    # 需求、设计与笔记
├── tests/                   # pytest 单元测试
├── run.py                   # 快速启动脚本
└── requirements.txt         # Python 依赖
```

## ⚙️ 快速开始

### 获取代码

**选项1：Fork 项目（推荐用于开发）**
1. 点击页面右上角的 ⭐ **Star** 按钮收藏项目
2. 点击 🍴 **Fork** 按钮将项目 fork 到你的 GitHub 账户
3. 克隆你的 fork 到本地：
```bash
git clone https://github.com/你的用户名/QPDS.git
cd QPDS
```

**选项2：直接下载**
```bash
git clone https://github.com/原作者用户名/QPDS.git
cd QPDS
```

### 启动服务

### 方式一：一键启动（推荐）
```bash
python3 run.py
```

脚本将自动完成：
1. 检测并创建虚拟环境 `venv/`
2. 安装 `requirements.txt` 中的所有依赖
3. 启动后端 API 服务（默认监听 http://localhost:8080）

启动完成后，用浏览器打开 `frontend/index.html` 即可开始使用。保持脚本运行窗口打开，按 `Ctrl+C` 可随时停止服务。

### 方式二：手动操作
```bash
python3 -m venv venv
source venv/bin/activate          # Windows: venv\Scripts\activate
python -m pip install -r requirements.txt
python -m backend.api.app         # 启动后端（默认端口 8080）
```
前端同样通过直接打开 `frontend/index.html` 访问。

## ☁️ 部署上线
- 推荐使用 GitHub Pages + Render 组合：前端静态文件部署到 GitHub Pages，后端 Flask API 托管在 Render。
- 页面右上角新增 `⚙️ API` 按钮，可在浏览器内填写 Render 提供的 HTTPS 地址，并保存在本地浏览器。
- 完整上线步骤与注意事项见 `docs/deployment/github-pages-render.md`。

## 🚀 新手快速入门

### 第一次使用？从这里开始！

1. **启动系统**：运行 `python3 run.py`，在浏览器打开 `frontend/index.html`
2. **选择底牌**：点击界面左上角的两个空槽，然后从牌堆中选择你的两张底牌
3. **设置参数**：
   - 选择当前阶段（翻前/翻牌/转牌/河牌）
   - 如果不是翻前，点击公共牌区域选择相应数量的公共牌
   - 输入底池大小、需要跟注金额、你和对手的筹码量
   - 选择你的位置（如果不确定，先选择按钮位BTN）
4. **获取建议**：点击"获取决策建议"按钮，系统会给出推荐行动
5. **查看手册**：点击右上角"🃏 游戏手册"了解详细规则和策略

### 新手建议的第一次设置
- **底牌**：选择一对A（AA）或A-K等强牌
- **阶段**：从翻前开始练习
- **位置**：选择按钮位（BTN），这是最有利的位置
- **底池**：设置为100，跟注为20（简单的比例）
- **筹码**：双方各500（常见的100大盲深度）

### 理解系统输出
系统会告诉你：
- **推荐行动**：加注/跟注/弃牌等
- **置信度**：系统对建议的确信程度
- **期望值**：这个决策的预期盈利
- **关键因子**：影响决策的重要数据（胜率、底池赔率等）

## 🃏 德州扑克游戏规则

### 基本规则
德州扑克（Texas Hold'em）是一种流行的扑克变体，每位玩家发2张底牌，通过与5张公共牌结合组成最佳的5张牌型。

### 游戏流程
1. **翻前（Pre-flop）**：每位玩家获得2张底牌，根据牌力决定跟注、加注或弃牌
2. **翻牌（Flop）**：发出前3张公共牌，进行新一轮下注
3. **转牌（Turn）**：发出第4张公共牌，继续下注
4. **河牌（River）**：发出第5张公共牌，最后一轮下注
5. **摊牌（Showdown）**：比较牌型大小，最大牌型获胜

### 牌型排名（从大到小）
| 牌型 | 说明 | 示例 |
|------|------|------|
| 皇家同花顺 | A-K-Q-J-10同花色 | A♠ K♠ Q♠ J♠ 10♠ |
| 同花顺 | 连续5张同花色牌 | 9♥ 8♥ 7♥ 6♥ 5♥ |
| 四条 | 4张相同点数 | K♣ K♦ K♥ K♠ 3♦ |
| 葫芦 | 三条+对子 | Q♠ Q♥ Q♦ 7♣ 7♠ |
| 同花 | 5张同花色牌 | A♦ J♦ 9♦ 6♦ 2♦ |
| 顺子 | 连续5张牌 | 10♠ 9♥ 8♦ 7♣ 6♠ |
| 三条 | 3张相同点数 | 8♣ 8♦ 8♥ K♠ 4♦ |
| 两对 | 两个对子 | A♠ A♥ 5♣ 5♦ 9♠ |
| 一对 | 一个对子 | J♦ J♠ 10♥ 8♣ 3♦ |
| 高牌 | 无以上牌型 | A♠ K♦ Q♥ 8♣ 5♠ |

### 关键概念
- **底池赔率（Pot Odds）**：当前跟注所需筹码与底池大小的比例
- **隐含赔率（Implied Odds）**：考虑后续可能赢得筹码的赔率
- **位置（Position）**：相对于庄家位置，后位置有信息优势
- **筹码-底池比（SPR）**：有效筹码除以底池大小
- **听牌（Draw）**：需要特定牌才能成牌的牌型（如同花听牌、顺子听牌）

### 位置系统详解
德州扑克中位置极其重要，决定了你的行动顺序和信息优势：

#### 前位（Early Position）- 最先行动，需要强牌
- **UTG（枪口位）**：翻前第一个行动，信息最少，需要最强的起手牌
- **UTG+1, UTG+2**：紧随其后的位置，仍需要较强手牌

#### 中位（Middle Position）- 平衡位置
- **MP1, MP2, MP3**：可以适当放宽手牌要求，观察前位行动

#### 后位（Late Position）- 信息优势明显
- **LJ（劫匪位）, HJ（劫持位）**：可以观察多数玩家行动后决策
- **CO（截断位）**：仅次于按钮位的优势位置
- **BTN（按钮位）**：翻后永远最后行动，最有利位置

#### 盲注位（Blind Positions）- 特殊位置
- **SB（小盲位）**：翻后第一个行动，位置最差但已有投入
- **BB（大盲位）**：翻前最后行动权，需考虑底池赔率

> **新手提示**：前位要紧，后位要松。按钮位可以用更宽的范围加注和偷盲，而UTG位置需要非常谨慎的手牌选择。

### 常用策略概念
- **紧凶（TAG）**：只玩强牌但玩得激进
- **松凶（LAG）**：玩较多牌型且激进下注
- **价值下注**：有强牌时下注获取价值
- **诈唬（Bluff）**：用弱牌下注迫使对手弃牌
- **半诈唬**：用听牌下注，既可能成牌也可能让对手弃牌

## 💡 核心功能

### 前端交互
- **智能牌面选择器**：支持自动灰化已选卡牌、点击移除等直观操作
- **阶段智能切换**：翻前/翻牌/转牌/河牌切换时自动限制公共牌数量
- **实时参数汇总**：底池、跟注金额、双方筹码、风险偏好等输入即时展示
- **本地化错误提示**：指导用户补全必需信息，支持中英文

### 后端服务
- `POST /api/get_recommendation`：基于当前局面分析，返回推荐行动、金额、期望值与详细解释
- `POST /api/get_equity`：针对给定牌面与对手范围进行蒙特卡罗胜率模拟
- `GET /health`：服务健康状态检查
- **完整因子详情**：响应包含所有关键因子明细，便于前端展示或第三方系统集成

### 核心因子体系
| 因子名称 | 含义说明 | 取值范围 | 用途 |
| ---- | ---- | -------- | ---- |
| `equity` | 对手范围下的胜率 | 0 ~ 1 | 基础牌力评估 |
| `pot_odds` | 跟注所需最低胜率 | 0 ~ 1 | 数学期望计算 |
| `hand_strength` | 当前牌力强度评分 | 0 ~ 1 | 摊牌价值判断 |
| `stack_to_pot_ratio` | 有效筹码与底池比例 | 0 ~ ∞ | 资金管理指导 |
| `fold_equity` | 估计对手弃牌概率 | 0 ~ 1 | 诈唬决策依据 |
| `pot_commitment` | 底池投入承诺度 | 0 ~ 1 | 风险控制评估 |
| `position_factor` | 位置优势系数 | 0 ~ 1 | 策略调整参考 |

## 🧪 测试

运行完整测试套件：
```bash
source venv/bin/activate
pytest
```

运行特定测试模块：
```bash
pytest tests/test_hand_evaluator.py  # 测试牌力评估器
pytest -k "factor"                   # 运行所有因子相关测试
pytest -v                           # 详细输出模式
```

测试覆盖核心逻辑包括因子引擎、权益计算、决策推理等关键模块。

## 🛠️ 常见问题

**Q: 依赖安装失败（如 LightGBM 编译错误）**
A: 脚本会自动升级 pip 并优先安装预编译轮子。如仍有问题，可手动执行：
```bash
python -m pip install --upgrade pip setuptools wheel
python -m pip install lightgbm --no-cache-dir
```

**Q: 前端无法获取推荐结果**
A: 请检查：
- 后端服务是否正常启动（访问 http://localhost:8080/health 应返回 `{"status": "ok"}`）
- 浏览器控制台是否有跨域或网络错误
- `frontend/index.html` 中的 `API_URL` 是否与后端端口一致

**Q: 界面显示异常或翻译缺失**
A: 刷新页面或清除浏览器缓存，确保 JavaScript 正常加载。

## 🗺️ 发展路线图

### 已完成功能 ✅
- [x] 双语交互前端界面与牌局输入系统
- [x] 多因子计算引擎与决策 REST API
- [x] 德州扑克游戏规则集成与手册功能

### 规划中功能 🚧
- [ ] **手牌历史分析**：解析历史牌局数据，支持回放与复盘
- [ ] **高级对手建模**：自定义对手范围、倾向性参数输入
- [ ] **数据持久化**：手牌记录存储与统计分析
- [ ] **回测系统**：策略效果验证与优化建议
- [ ] **前端现代化**：迁移至 Vue/React + TypeScript 架构

### 长期愿景 🎯
- [ ] **机器学习增强**：基于大量手牌数据的策略优化
- [ ] **移动端支持**：响应式设计与 PWA 适配
- [ ] **多人对局支持**：扩展至多人桌面决策分析

## 📄 许可证
本项目基于 MIT 协议开源，详情参见 [LICENSE](LICENSE)。

## 🙏 致谢
- 扑克牌力评估算法基于 Cactus Kev's evaluator 实现
- 蒙特卡罗模拟方法借鉴 PokerStove 设计思路
- 量化分析框架参考现代投资组合理论

## 📧 联系方式

如有问题或建议，欢迎在 GitHub 上提交 Issue。

也可以通过我的个人博客联系：https://akuiro24.xyz/

---

**免责声明**：本工具仅供教育学习使用。在使用扑克辅助工具前，请务必确认平台政策合规性。
