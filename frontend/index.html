<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QPDS - Quantitative Poker Decision System</title>
    <style>
        :root {
            color-scheme: dark;
            --bg-primary: #2d2b55;
            --bg-secondary: #1e1b48;
            --bg-tertiary: #160f3d;
            --accent-purple: #b362ff;
            --accent-cyan: #64f4ff;
            --accent-pink: #ff7edb;
            --accent-gold: #f7c548;
            --text-primary: #f8f7ff;
            --text-secondary: #c7c7ff;
            --text-muted: #9da1ff;
            --panel-border: rgba(137, 97, 255, 0.45);
            --panel-bg: rgba(29, 26, 66, 0.85);
            --chip-shadow: 0 18px 35px rgba(99, 72, 199, 0.45);
            --card-shadow: 0 12px 28px rgba(22, 14, 46, 0.6);
            --font-sans: 'Inter', 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            --font-code: 'JetBrains Mono', 'Fira Code', 'Cascadia Code', 'Operator Mono', Menlo, Monaco, 'Courier New', monospace;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-sans);
            background: radial-gradient(circle at top left, rgba(100, 244, 255, 0.18), rgba(179, 98, 255, 0.05) 45%, transparent 70%),
                        linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 55%, var(--bg-tertiary) 100%);
            min-height: 100vh;
            padding: clamp(28px, 4vw, 56px) clamp(24px, 5vw, 72px) clamp(44px, 6vw, 96px);
            color: var(--text-primary);
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background:
                radial-gradient(circle at 20% 15%, rgba(100, 244, 255, 0.18), transparent 45%),
                radial-gradient(circle at 80% 10%, rgba(255, 126, 219, 0.2), transparent 55%),
                radial-gradient(circle at 50% 80%, rgba(179, 98, 255, 0.22), transparent 60%);
            opacity: 0.9;
            pointer-events: none;
            z-index: -2;
        }

        body::after {
            content: '';
            position: fixed;
            inset: 0;
            background-image: linear-gradient(115deg, rgba(255, 255, 255, 0.04) 0, rgba(255, 255, 255, 0.02) 40%, rgba(255, 255, 255, 0.05) 100%);
            mix-blend-mode: soft-light;
            opacity: 0.35;
            pointer-events: none;
            z-index: -1;
        }

        .app {
            max-width: clamp(1180px, 94vw, 1760px);
            margin: 0 auto;
            padding: 0 clamp(12px, 1.8vw, 36px) 48px;
            position: relative;
        }

        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            position: relative;
            padding: 14px 22px 20px;
            border-radius: 22px;
            background: linear-gradient(140deg, rgba(25, 21, 56, 0.78), rgba(46, 38, 98, 0.42));
            border: 1px solid rgba(158, 118, 255, 0.42);
            box-shadow: 0 26px 52px rgba(18, 12, 43, 0.55);
            overflow: hidden;
        }

        .app-header::after {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at 15% 15%, rgba(100, 244, 255, 0.25), transparent 60%),
                        radial-gradient(circle at 85% 20%, rgba(255, 126, 219, 0.25), transparent 60%);
            opacity: 0.55;
            pointer-events: none;
        }

        .header-buttons {
            display: flex;
            gap: 12px;
            align-items: center;
            position: relative;
            z-index: 1;
        }

        .header-art {
            position: absolute;
            inset: -40px -80px auto auto;
            width: 360px;
            height: 240px;
            pointer-events: none;
            display: flex;
            justify-content: flex-end;
            align-items: flex-start;
            gap: 18px;
            transform: rotate(-6deg);
            opacity: 0.75;
            flex-wrap: wrap;
        }

        .chip {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: radial-gradient(circle at 35% 35%, rgba(255, 255, 255, 0.32), rgba(179, 98, 255, 0.82));
            border: 6px double rgba(255, 255, 255, 0.55);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 2.1rem;
            text-shadow: 0 12px 32px rgba(0, 0, 0, 0.35);
            box-shadow: var(--chip-shadow);
            animation: chipFloat 6s ease-in-out infinite;
        }

        .chip-ace {
            width: 120px;
            height: 120px;
            font-size: 2.4rem;
            background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.45), rgba(100, 244, 255, 0.82));
            animation-delay: 0.5s;
        }

        .chip-heart {
            background: radial-gradient(circle at 35% 35%, rgba(255, 255, 255, 0.35), rgba(255, 126, 219, 0.78));
            border-width: 5px;
            animation-delay: 1.5s;
        }

        .chip-diamond {
            background: radial-gradient(circle at 35% 35%, rgba(255, 255, 255, 0.32), rgba(247, 197, 72, 0.8));
            border-width: 4px;
            animation-delay: 2.3s;
        }

        .chip-club {
            background: radial-gradient(circle at 35% 35%, rgba(255, 255, 255, 0.3), rgba(179, 98, 255, 0.75));
            border-width: 4px;
            animation-delay: 3.1s;
        }

        @keyframes chipFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-14px) rotate(4deg); }
        }

        .settings-btn,
        .lang-toggle {
            padding: 10px 20px;
            border: 1px solid rgba(179, 98, 255, 0.35);
            border-radius: 999px;
            background: rgba(179, 98, 255, 0.16);
            color: var(--text-primary);
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
            backdrop-filter: blur(6px);
        }

        .settings-btn:hover,
        .lang-toggle:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 28px rgba(15, 16, 48, 0.45);
            border-color: rgba(100, 244, 255, 0.45);
        }

        .api-status {
            font-size: 0.85rem;
            color: rgba(247, 249, 252, 0.92);
            background: rgba(100, 244, 255, 0.12);
            border-radius: 999px;
            padding: 6px 12px;
            border: 1px solid rgba(100, 244, 255, 0.32);
        }

        .title-block {
            position: relative;
            z-index: 1;
        }

        .title-block h1 {
            font-size: 2.7rem;
            font-weight: 700;
            letter-spacing: 0.06em;
            color: var(--accent-cyan);
            text-shadow: 0 10px 24px rgba(100, 244, 255, 0.28);
        }

        .title-block p {
            margin-top: 6px;
            font-size: 1.05rem;
            color: var(--text-muted);
            opacity: 0.9;
        }

        .layout {
            display: grid;
            grid-template-columns:
                clamp(300px, 23vw, 380px)
                clamp(560px, 48vw, 820px)
                clamp(300px, 23vw, 380px);
            grid-template-areas: 'guide main side';
            gap: clamp(22px, 3vw, 42px);
            align-items: start;
            justify-content: center;
        }

        #lessonPanel {
            grid-area: guide;
            position: sticky;
            top: 24px;
        }

        #statePanel {
            grid-area: main;
        }

        #analysisPanel {
            grid-area: side;
        }

        .panel {
            background: linear-gradient(165deg, rgba(30, 41, 59, 0.88), rgba(15, 23, 42, 0.96));
            backdrop-filter: blur(16px);
            border-radius: 22px;
            padding: 28px;
            border: 1px solid rgba(148, 163, 184, 0.22);
            box-shadow: 0 26px 52px rgba(15, 23, 42, 0.5);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            gap: 20px;
            height: 100%;
        }

        .panel::before {
            content: '';
            position: absolute;
            inset: 1.5px;
            border-radius: 20px;
            border: 1px solid rgba(100, 244, 255, 0.08);
            pointer-events: none;
        }

        .panel::after {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at top right, rgba(255, 126, 219, 0.14), transparent 60%),
                        radial-gradient(circle at bottom left, rgba(100, 244, 255, 0.12), transparent 55%);
            opacity: 0.35;
            pointer-events: none;
        }

        .panel h2 {
            font-size: 1.42rem;
            margin-bottom: 20px;
            color: #e0f2fe;
            display: inline-flex;
            align-items: center;
            gap: 12px;
            letter-spacing: 0.04em;
        }

        .panel h2::before {
            content: '‚ô†';
            font-size: 1.45rem;
            color: var(--accent-purple);
            text-shadow: 0 0 12px rgba(179, 98, 255, 0.6);
        }

        #lessonPanel > h2::before { content: '‚ô£'; color: var(--accent-pink); }
        #statePanel > h2::before { content: '‚ô†'; }

        .lesson-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 16px;
            margin-top: 18px;
        }

        .lesson-item {
            background: rgba(37, 33, 74, 0.55);
            border-radius: 14px;
            padding: 16px 18px;
            border-left: 4px solid rgba(179, 98, 255, 0.8);
            box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.05);
        }

        .game-manual-btn {
            padding: 10px 20px;
            border: 1px solid rgba(255, 126, 219, 0.4);
            border-radius: 999px;
            background: rgba(255, 126, 219, 0.18);
            color: var(--text-primary);
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
            backdrop-filter: blur(6px);
        }

        .game-manual-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 18px 32px rgba(78, 15, 86, 0.45);
            border-color: rgba(255, 126, 219, 0.6);
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: none;
        }

        .modal-overlay.show {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: linear-gradient(135deg, #374785, #243B55);
            border-radius: 16px;
            padding: 30px;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            margin: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            color: #f7f9fc;
        }

        .modal-content.compact {
            max-width: 760px;
            padding: 30px 36px 26px;
        }

        .modal-content.medium {
            max-width: 880px;
            padding: 32px 40px 30px;
        }

        .modal-content.wide {
            max-width: 920px;
            padding: 34px 42px 30px;
        }

        .modal-body {
            display: flex;
            flex-direction: column;
            gap: 18px;
        }

        .modal-actions {
            margin-top: 20px;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        .modal-actions button {
            padding: 10px 18px;
            border-radius: 10px;
            border: 1px solid rgba(148, 163, 184, 0.25);
            background: rgba(24, 21, 54, 0.65);
            color: var(--text-primary);
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .modal-actions button.primary {
            background: linear-gradient(135deg, rgba(179, 98, 255, 0.6), rgba(100, 244, 255, 0.45));
            border-color: rgba(100, 244, 255, 0.4);
        }

        .modal-actions button:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(10, 8, 30, 0.45);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 16px;
        }

        .modal-title {
            font-size: 2rem;
            font-weight: 700;
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            color: #f7f9fc;
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: background 0.2s ease;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .manual-section {
            margin-bottom: 24px;
        }

        .manual-section h3 {
            font-size: 1.3rem;
            margin-bottom: 12px;
            color: #8ec5fc;
        }

        .manual-section p, .manual-section li {
            line-height: 1.6;
            margin-bottom: 8px;
        }

        .manual-section ul {
            padding-left: 20px;
        }

        .hand-rankings {
            display: grid;
            gap: 12px;
        }

        .hand-rank {
            background: rgba(255, 255, 255, 0.06);
            border-radius: 8px;
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .hand-rank-name {
            font-weight: 600;
        }

        .hand-rank-example {
            font-family: monospace;
            color: #8ec5fc;
        }

        .position-categories {
            margin: 16px 0;
        }

        .position-category {
            background: rgba(255, 255, 255, 0.04);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            border-left: 4px solid #8ec5fc;
        }

        .position-category h4 {
            margin: 0 0 12px 0;
            color: #8ec5fc;
            font-size: 1.1rem;
        }

        .position-category ul {
            margin: 0;
            padding-left: 20px;
        }

        .position-category li {
            margin-bottom: 8px;
        }

        .position-tips {
            background: rgba(142, 197, 252, 0.1);
            border-radius: 12px;
            padding: 16px;
            margin-top: 20px;
        }

        .position-tips h4 {
            margin: 0 0 12px 0;
            color: #8ec5fc;
        }

        .position-tips ul {
            margin: 0;
            padding-left: 20px;
        }

        .position-tips li {
            margin-bottom: 8px;
        }

        .beginner-tip {
            background: linear-gradient(135deg, rgba(142, 197, 252, 0.15), rgba(68, 189, 50, 0.1));
            border: 2px solid rgba(142, 197, 252, 0.3);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 24px;
            animation: glow 2s infinite alternate;
        }

        @keyframes glow {
            from { box-shadow: 0 0 5px rgba(142, 197, 252, 0.3); }
            to { box-shadow: 0 0 20px rgba(142, 197, 252, 0.6); }
        }

        .beginner-tip h3 {
            margin: 0 0 12px 0;
            color: #8ec5fc;
            font-size: 1.2rem;
        }

        .beginner-steps {
            margin: 12px 0;
            padding-left: 20px;
            line-height: 1.6;
        }

        .beginner-steps li {
            margin-bottom: 8px;
            color: #f0f4ff;
        }

        .dismiss-tip {
            background: rgba(142, 197, 252, 0.2);
            border: 1px solid rgba(142, 197, 252, 0.4);
            color: #f0f4ff;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 12px;
            transition: all 0.2s ease;
        }

        .dismiss-tip:hover {
            background: rgba(142, 197, 252, 0.3);
            transform: translateY(-1px);
        }

        .beginner-tip.hidden {
            display: none;
        }

        .hand-categories {
            margin: 16px 0;
        }

        .hand-category {
            background: rgba(255, 255, 255, 0.04);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .hand-category.premium {
            border-left: 4px solid #4CAF50;
        }

        .hand-category.strong {
            border-left: 4px solid #FF9800;
        }

        .hand-category.speculative {
            border-left: 4px solid #2196F3;
        }

        .hand-category h4 {
            margin: 0 0 12px 0;
            font-size: 1rem;
        }

        .hand-examples {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .hand-example {
            background: rgba(255, 255, 255, 0.1);
            padding: 6px 10px;
            border-radius: 6px;
            font-family: monospace;
            font-weight: 600;
            font-size: 0.9rem;
            color: #8ec5fc;
        }

        .hand-tips {
            background: rgba(142, 197, 252, 0.1);
            border-radius: 8px;
            padding: 12px;
            margin-top: 16px;
        }

        .hand-tips p {
            margin: 0;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .lesson-item strong {
            display: block;
            font-size: 0.95rem;
            margin-bottom: 6px;
        }

        .lesson-item span {
            font-size: 0.92rem;
            opacity: 0.9;
            line-height: 1.5;
        }

        .cheatsheet {
            margin-top: 22px;
            padding: 18px 20px;
            border-radius: 18px;
            background: rgba(25, 23, 60, 0.65);
            border: 1px solid rgba(148, 163, 184, 0.18);
            box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.04);
        }

        .cheatsheet h3 {
            font-size: 1.02rem;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            color: var(--text-secondary);
            margin-bottom: 16px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .cheatsheet h3::before {
            content: '‚ô£';
            font-size: 1.2rem;
            color: var(--accent-cyan);
            text-shadow: 0 0 10px rgba(100, 244, 255, 0.55);
        }

        .cheatsheet-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 18px;
        }

        .cheatsheet-card {
            background: rgba(20, 18, 48, 0.72);
            border-radius: 14px;
            padding: 16px;
            border: 1px solid rgba(148, 163, 184, 0.18);
            box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.04);
        }

        .cheatsheet-label {
            font-size: 0.9rem;
            color: var(--accent-purple);
            text-transform: uppercase;
            letter-spacing: 0.08em;
            margin-bottom: 10px;
        }

        .cheatsheet-card ul {
            margin: 0;
            padding-left: 18px;
            display: grid;
            gap: 8px;
        }

        .cheatsheet-card li {
            font-size: 0.9rem;
            color: var(--text-primary);
            line-height: 1.45;
        }

        .section {
            margin-bottom: 18px;
        }

        .section h3 {
            font-size: 1.08rem;
            margin-bottom: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .section h3::before {
            content: '‚ô¶';
            font-size: 1.2rem;
            color: var(--accent-pink);
            text-shadow: 0 0 10px rgba(255, 126, 219, 0.55);
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: clamp(16px, 2.2vw, 28px);
            margin-bottom: clamp(20px, 2.8vw, 36px);
        }

        #statePanel .cards-grid .section {
            margin-bottom: 0;
        }

        .card-panel {
            background: rgba(26, 27, 65, 0.7);
            border: 1px solid rgba(148, 163, 184, 0.18);
            border-radius: 20px;
            padding: clamp(16px, 2vw, 24px);
            box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.04), 0 18px 30px rgba(9, 10, 32, 0.35);
        }

        .card-panel h3 {
            margin-bottom: clamp(10px, 1.2vw, 16px);
        }

        .stage-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
            gap: 10px;
            margin-bottom: 18px;
        }

        .stage-options label {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(29, 27, 68, 0.6);
            border-radius: 12px;
            padding: 10px 14px;
            cursor: pointer;
            transition: background 0.2s ease, border 0.2s ease;
            font-size: 0.92rem;
            border: 1px solid rgba(148, 163, 184, 0.2);
        }

        .stage-options label:hover {
            border-color: rgba(100, 244, 255, 0.35);
        }

        .stage-options input[type="radio"] {
            accent-color: var(--accent-purple);
        }

        .stage-options label.active {
            background: linear-gradient(140deg, rgba(179, 98, 255, 0.28), rgba(100, 244, 255, 0.22));
            border: 1px solid rgba(100, 244, 255, 0.45);
        }

        .card-slots {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(78px, 1fr));
            gap: 12px;
        }

        .card-slot {
            position: relative;
            border-radius: 16px;
            min-height: 110px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.45rem;
            color: rgba(255, 255, 255, 0.68);
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease, border 0.2s ease, background 0.2s ease;
            background: linear-gradient(155deg, rgba(45, 43, 85, 0.65), rgba(24, 18, 52, 0.85));
            border: 1px solid rgba(148, 163, 184, 0.22);
            box-shadow: var(--card-shadow);
        }

        .card-slot[data-disabled="true"] {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .card-slot[data-selected="true"] {
            border-color: rgba(100, 244, 255, 0.65);
            background: linear-gradient(160deg, rgba(100, 244, 255, 0.18), rgba(94, 53, 156, 0.55));
            transform: translateY(-4px);
            box-shadow: 0 18px 32px rgba(21, 13, 52, 0.55);
        }

        .card-slot .card-label {
            position: absolute;
            top: 6px;
            left: 8px;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            color: rgba(255, 255, 255, 0.55);
        }

        .card-slot .remove-tag {
            position: absolute;
            top: 6px;
            right: 6px;
            background: rgba(179, 98, 255, 0.22);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.85);
        }

        .card-slot[data-filled="true"] {
            border-color: rgba(255, 126, 219, 0.45);
            background: linear-gradient(160deg, rgba(255, 241, 255, 0.14), rgba(122, 87, 244, 0.45));
            color: #fff;
            font-weight: 600;
            text-shadow: 0 4px 12px rgba(0, 0, 0, 0.35);
        }

        .card-slot[data-filled="true"] .remove-tag {
            cursor: pointer;
        }

        .inputs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
        }

        label.field-label {
            display: flex;
            flex-direction: column;
            gap: 6px;
            font-size: 0.85rem;
            opacity: 0.85;
            letter-spacing: 0.04em;
        }

        input[type="number"],
        input[type="text"],
        select {
            background: rgba(31, 28, 66, 0.75);
            border: 1px solid rgba(148, 163, 184, 0.28);
            border-radius: 12px;
            padding: 11px 14px;
            color: var(--text-primary);
            font-size: 0.96rem;
            font-family: var(--font-code);
            letter-spacing: 0.01em;
            transition: border 0.2s ease, box-shadow 0.2s ease;
        }

        input::placeholder,
        select option {
            color: rgba(255, 255, 255, 0.6);
        }

        select {
            cursor: pointer;
        }

        input[type="number"]:focus,
        input[type="text"]:focus,
        select:focus {
            border-color: rgba(100, 244, 255, 0.55);
            box-shadow: 0 0 0 3px rgba(100, 244, 255, 0.2);
        }

        .slider-row {
            display: flex;
            align-items: center;
            gap: 14px;
            margin-top: 10px;
        }

        .slider-row span {
            font-size: 0.82rem;
            opacity: 0.75;
        }

        .slider-row strong {
            font-size: 0.95rem;
            color: #f1f5ff;
        }

        input[type="range"] {
            flex: 1;
            accent-color: var(--accent-purple);
        }

        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 20px;
        }

        .deck-section {
            margin-top: 18px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .deck-section h3::before {
            content: '‚ô¶';
            color: var(--accent-gold);
        }

        .deck-hint {
            font-size: 0.9rem;
            opacity: 0.75;
            line-height: 1.5;
            color: var(--text-muted);
        }


        .button-group button {
            flex: 1 1 180px;
            padding: 12px 16px;
            border: 1px solid rgba(179, 98, 255, 0.35);
            border-radius: 14px;
            font-size: 0.96rem;
            font-weight: 600;
            cursor: pointer;
            color: var(--text-primary);
            background: linear-gradient(135deg, rgba(179, 98, 255, 0.38), rgba(100, 244, 255, 0.2));
            transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
            backdrop-filter: blur(6px);
        }

        .button-group button:hover {
            transform: translateY(-3px);
            box-shadow: 0 18px 36px rgba(21, 17, 56, 0.55);
            border-color: rgba(100, 244, 255, 0.45);
        }

        .button-group .ghost {
            background: rgba(37, 33, 74, 0.55);
            color: var(--text-muted);
            border-color: rgba(148, 163, 184, 0.25);
        }

        .deck-grid {
            display: grid;
            gap: 10px;
            padding: 12px 14px;
            background: rgba(21, 19, 48, 0.6);
            border-radius: 18px;
            border: 1px solid rgba(148, 163, 184, 0.18);
            box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.04);
            overflow-x: auto;
        }

        .deck-row {
            display: grid;
            grid-template-columns: 48px repeat(13, minmax(44px, 1fr));
            gap: 8px;
            align-items: center;
            padding: 6px 0;
        }

        .deck-suit {
            justify-self: center;
            font-size: 1.4rem;
            color: var(--accent-cyan);
            text-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
            opacity: 0.9;
        }

        .deck-row[data-suit="hearts"] .deck-suit { color: #ff7d9c; }
        .deck-row[data-suit="diamonds"] .deck-suit { color: var(--accent-gold); }
        .deck-row[data-suit="clubs"] .deck-suit { color: var(--accent-purple); }

        .card-button {
            border: 1px solid rgba(148, 163, 184, 0.22);
            border-radius: 10px;
            padding: 10px 6px;
            font-size: 0.96rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.15s ease, filter 0.15s ease, border-color 0.15s ease;
            background: linear-gradient(150deg, rgba(45, 43, 85, 0.9), rgba(28, 20, 58, 0.85));
            color: var(--text-primary);
            box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.04);
            font-family: var(--font-code);
            justify-self: center;
        }

        .card-button[data-suit="hearts"],
        .card-button[data-suit="diamonds"] {
            color: #ff7d9c;
        }

        .card-button[data-suit="spades"],
        .card-button[data-suit="clubs"] {
            color: #64f4ff;
        }

        .card-button:hover {
            transform: translateY(-3px);
            border-color: rgba(100, 244, 255, 0.35);
            box-shadow: 0 15px 26px rgba(19, 12, 44, 0.45);
        }

        .card-button[data-used="true"] {
            filter: saturate(0.3) brightness(0.7);
            opacity: 0.4;
            cursor: not-allowed;
        }

        .analysis-panel {
            background: linear-gradient(160deg, rgba(26, 24, 60, 0.95), rgba(13, 11, 34, 0.94));
            border-radius: 24px;
            padding: 28px;
            border: 1px solid rgba(148, 118, 255, 0.32);
            box-shadow: 0 30px 58px rgba(8, 6, 24, 0.55);
            display: flex;
            flex-direction: column;
            gap: 24px;
            position: sticky;
            top: 24px;
            max-height: calc(100vh - 48px);
            overflow: auto;
            scrollbar-width: thin;
        }

        .analysis-overview {
            display: grid;
            grid-template-columns: minmax(0, 1.35fr) minmax(0, 0.65fr);
            gap: 20px;
            align-items: stretch;
        }

        .overview-card {
            background: rgba(20, 18, 48, 0.78);
            border-radius: 18px;
            padding: 20px 22px;
            border: 1px solid rgba(148, 163, 184, 0.2);
            box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.04);
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .overview-title {
            font-size: 0.82rem;
            text-transform: uppercase;
            letter-spacing: 0.14em;
            color: var(--text-secondary);
        }

        .overview-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 14px;
        }

        .overview-item {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .overview-item span {
            font-size: 0.78rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
        }

        .badge-row {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .badge-row .card-badge {
            background: rgba(37, 33, 74, 0.65);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 10px;
            padding: 6px 10px;
            font-size: 0.94rem;
            font-weight: 600;
            letter-spacing: 0.06em;
            color: var(--text-primary);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 44px;
        }

        .overview-actions {
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        .overview-button {
            padding: 16px 18px;
            border-radius: 16px;
            background: linear-gradient(135deg, rgba(45, 43, 85, 0.85), rgba(28, 20, 58, 0.9));
            border: 1px solid rgba(148, 163, 184, 0.18);
            color: var(--text-primary);
            font-size: 0.98rem;
            font-weight: 600;
            letter-spacing: 0.05em;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
            cursor: pointer;
        }

        .overview-button:hover {
            transform: translateY(-3px);
            border-color: rgba(100, 244, 255, 0.35);
            box-shadow: 0 18px 36px rgba(11, 16, 42, 0.45);
        }

        .overview-button .hint {
            font-size: 0.78rem;
            color: var(--text-muted);
            letter-spacing: 0.08em;
        }

        .opponent-callout {
            background: rgba(37, 33, 74, 0.82);
            border-radius: 18px;
            padding: 18px 20px;
            border: 1px solid rgba(148, 163, 184, 0.28);
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 18px;
        }

        .opponent-callout-text {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .opponent-callout-text p {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.72);
            line-height: 1.5;
        }

        .callout-label {
            font-size: 0.78rem;
            text-transform: uppercase;
            letter-spacing: 0.16em;
            color: var(--text-secondary);
        }

        .callout-button {
            padding: 12px 20px;
            border-radius: 999px;
            border: none;
            background: linear-gradient(135deg, rgba(100, 244, 255, 0.9), rgba(179, 98, 255, 0.9));
            color: #0b1025;
            font-weight: 700;
            font-size: 0.95rem;
            cursor: pointer;
            box-shadow: 0 16px 32px rgba(19, 12, 44, 0.45);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            white-space: nowrap;
        }

        .callout-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 24px 40px rgba(19, 12, 44, 0.55);
        }

        .analysis-top {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 18px;
        }

        .result-banner {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 18px;
        }

        .analysis-metric {
            background: rgba(24, 21, 54, 0.78);
            border-radius: 14px;
            padding: 16px;
            border: 1px solid rgba(148, 163, 184, 0.2);
            box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.04);
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .analysis-metric-label {
            font-size: 0.78rem;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            color: var(--text-muted);
        }

        .analysis-metric-value {
            font-size: 1.45rem;
            font-weight: 700;
            color: var(--text-primary);
            text-shadow: 0 10px 28px rgba(0, 0, 0, 0.35);
        }

        .analysis-body {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 24px;
        }

        .analysis-column {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .analysis-box {
            background: rgba(20, 18, 48, 0.78);
            border-radius: 18px;
            padding: 20px 22px;
            border: 1px solid rgba(148, 163, 184, 0.2);
            box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.04);
        }

        .analysis-box-title {
            font-size: 0.82rem;
            text-transform: uppercase;
            letter-spacing: 0.14em;
            color: var(--text-secondary);
            margin-bottom: 14px;
        }

        .card-badges-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 12px;
        }

        .card-badges-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
        }

        .card-badges {
            display: flex;
            gap: 6px;
        }

        .card-badge {
            min-width: 38px;
            padding: 8px 10px;
            border-radius: 10px;
            background: rgba(31, 28, 66, 0.85);
            border: 1px solid rgba(148, 163, 184, 0.2);
            font-family: var(--font-code);
            font-size: 0.95rem;
            text-align: center;
            color: var(--text-primary);
            text-shadow: 0 6px 16px rgba(0, 0, 0, 0.35);
        }

        .card-badge--empty {
            opacity: 0.35;
        }

        .card-badge--h { color: #ff7d9c; }
        .card-badge--d { color: var(--accent-gold); }
        .card-badge--c { color: var(--accent-purple); }
        .card-badge--s { color: var(--accent-cyan); }

        @media (max-width: 1024px) {
            .analysis-panel {
                padding: 26px;
            }
        }

        @media (max-width: 768px) {
            .analysis-panel {
                padding: 22px 18px;
            }
        }

        .explanation-box {
            background: rgba(26, 23, 60, 0.82);
            border-radius: 12px;
            padding: 16px;
            font-size: 0.94rem;
            line-height: 1.6;
            border: 1px solid rgba(148, 163, 184, 0.18);
            color: var(--text-secondary);
        }

        .factors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 10px;
        }

        .factor-card {
            background: rgba(15, 23, 42, 0.6);
            border-radius: 14px;
            padding: 16px;
            border: 1px solid rgba(148, 163, 184, 0.14);
            box-shadow: inset 0 0 0 1px rgba(34, 211, 238, 0.04);
        }

        .factor-card .factor-name {
            font-size: 0.75rem;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            opacity: 0.68;
        }

        .factor-card .factor-value {
            font-size: 1.2rem;
            font-weight: 600;
            margin-top: 6px;
            color: #e0f2fe;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 14px;
            margin-top: 18px;
        }

        .summary-item {
            background: rgba(15, 23, 42, 0.58);
            border-radius: 12px;
            padding: 14px;
            border: 1px solid rgba(148, 163, 184, 0.12);
        }

        .summary-item span {
            display: block;
            font-size: 0.78rem;
            letter-spacing: 0.08em;
            opacity: 0.7;
            text-transform: uppercase;
            color: var(--text-muted);
        }

        .summary-item strong {
            display: block;
            margin-top: 4px;
            font-size: 1.05rem;
            color: var(--accent-cyan);
        }

        .opponent-section {
            margin-top: 28px;
            padding: 20px;
            border-radius: 18px;
            background: rgba(30, 41, 59, 0.75);
            border: 1px solid rgba(148, 163, 184, 0.18);
        }

        .opponent-section h3 {
            margin-bottom: 16px;
            font-size: 1.1rem;
            color: #bae6fd;
        }

        .opponent-layout {
            display: grid;
            grid-template-columns: minmax(0, 1.1fr) minmax(280px, 0.9fr);
            gap: 24px;
            align-items: flex-start;
        }

        .trait-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 18px;
        }

        .detail-column {
            display: flex;
            flex-direction: column;
            gap: 18px;
        }

        .metric-slider .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
        }

        .metric-slider .metric-value {
            font-size: 0.95rem;
            color: #f8fafc;
            background: rgba(100, 244, 255, 0.12);
            padding: 4px 10px;
            border-radius: 999px;
            font-weight: 600;
            letter-spacing: 0.05em;
        }

        .metric-scale {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-top: 8px;
        }

        .metric-scale small {
            font-size: 0.78rem;
            color: rgba(226, 232, 240, 0.75);
            white-space: nowrap;
        }

        .metric-scale input[type="range"] {
            flex: 1;
        }

        .metric-field input[type="number"] {
            font-size: 0.95rem;
        }

        .metric-action .action-grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 12px;
            margin-top: 12px;
        }

        .metric-action select,
        .metric-action input {
            width: 100%;
        }

        .metric-notes textarea {
            min-height: 140px;
        }

        .metric-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 12px 14px;
            border-radius: 14px;
            background: rgba(15, 23, 42, 0.65);
            border: 1px solid rgba(148, 163, 184, 0.12);
        }

        .metric-group span {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .metric-group input[type="range"] {
            width: 100%;
        }

        .metric-group input[type="number"],
        .metric-group select,
        .metric-group textarea {
            width: 100%;
            padding: 8px 12px;
            border-radius: 10px;
            border: 1px solid rgba(148, 163, 184, 0.2);
            background: rgba(15, 23, 42, 0.6);
            color: #e2e8f0;
            resize: vertical;
        }

        .metric-group textarea {
            min-height: 64px;
        }

        .insights-panel {
            margin-top: 24px;
            padding: 20px;
            border-radius: 18px;
            background: rgba(15, 76, 129, 0.18);
            border: 1px solid rgba(56, 189, 248, 0.25);
        }

        .insights-header {
            display: flex;
            justify-content: flex-start;
            align-items: center;
            margin-bottom: 12px;
        }

        .archetype-pill {
            padding: 6px 14px;
            border-radius: 999px;
            background: rgba(56, 189, 248, 0.2);
            color: #bae6fd;
            font-weight: 600;
            font-size: 0.88rem;
        }

        .insight-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 14px;
        }

        .insight-card {
            padding: 14px;
            border-radius: 14px;
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(148, 163, 184, 0.16);
        }

        .insight-card strong {
            display: block;
            margin-bottom: 6px;
            color: #e0f2fe;
        }

        .insight-notes {
            margin-top: 16px;
            display: grid;
            gap: 8px;
        }

        .insight-note {
            padding: 10px 12px;
            border-radius: 12px;
            background: rgba(30, 58, 138, 0.25);
            border: 1px solid rgba(59, 130, 246, 0.28);
            font-size: 0.88rem;
            line-height: 1.4;
        }

        .loading {
            display: none;
            justify-content: center;
            align-items: center;
            gap: 12px;
            font-size: 0.95rem;
            color: rgba(255, 255, 255, 0.8);
        }

        .loading.active {
            display: flex;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.15);
            border-top: 4px solid #8ec5fc;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error-box {
            background: linear-gradient(135deg, rgba(214, 69, 65, 0.22), rgba(122, 38, 69, 0.28));
            border: 1px solid rgba(214, 69, 65, 0.45);
            border-radius: 14px;
            padding: 14px 16px;
            font-size: 0.9rem;
            line-height: 1.5;
            display: none;
            color: #ffeaf1;
            box-shadow: 0 18px 32px rgba(78, 15, 29, 0.35);
        }

        .error-box.active {
            display: block;
        }

        @media (min-width: 1500px) {
            .layout {
                grid-template-columns:
                    clamp(320px, 22vw, 420px)
                    clamp(680px, 50vw, 880px)
                    clamp(320px, 22vw, 420px);
                gap: clamp(28px, 3.5vw, 48px);
            }

            .panel {
                padding: clamp(28px, 2.1vw, 36px);
            }

            .analysis-panel {
                max-height: clamp(70vh, 82vh, 860px);
            }
        }

        @media (min-width: 1100px) {
            .button-group {
                flex-wrap: nowrap;
            }

            .button-group button {
                flex: 1 1 0;
            }
        }

        @media (max-width: 1320px) {
            .layout {
                grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
                grid-template-areas:
                    'guide main'
                    'side side';
            }

            #lessonPanel {
                position: sticky;
                top: 20px;
            }

            #analysisPanel {
                position: relative;
                top: auto;
                max-height: none;
                overflow: visible;
            }

            .analysis-overview {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 960px) {
            .layout {
                grid-template-columns: 1fr;
                grid-template-areas:
                    'guide'
                    'main'
                    'side';
            }

            #lessonPanel {
                position: relative;
                top: auto;
            }

            .opponent-layout {
                grid-template-columns: 1fr;
            }

            .metric-action .action-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 640px) {
            body {
                padding: 16px;
            }

            .app-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }

            .header-art {
                display: none;
            }

            .button-group button {
                flex: 1 1 100%;
            }

            .opponent-callout {
                flex-direction: column;
                gap: 14px;
            }

            .callout-button {
                width: 100%;
                text-align: center;
            }

            .trait-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <header class="app-header">
            <div class="title-block">
                <h1 data-i18n="title">QPDS</h1>
                <p data-i18n="subtitle">ÈáèÂåñÂæ∑Â∑ûÊâëÂÖãÂÜ≥Á≠ñËæÖÂä©Á≥ªÁªü</p>
            </div>
            <div class="header-buttons">
                <button class="game-manual-btn" id="gameManualBtn" data-i18n="buttons.gameManual">üÉè Ê∏∏ÊàèÊâãÂÜå</button>
                <button id="apiConfigBtn" class="settings-btn" data-i18n="buttons.apiConfig">‚öôÔ∏è API</button>
                <button id="langToggle" class="lang-toggle">English</button>
                <span class="api-status" id="apiStatusLabel"></span>
            </div>
            <div class="header-art" aria-hidden="true">
                <div class="chip chip-ace">A‚ô†</div>
                <div class="chip chip-heart">‚ô•</div>
                <div class="chip chip-diamond">‚ô¶</div>
                <div class="chip chip-club">‚ô£</div>
            </div>
        </header>

        <div class="layout">
            <section class="panel" id="lessonPanel">
                <h2 data-i18n="lesson.heading">Êó†ÈôêÊ≥®Âæ∑Â∑ûÊâëÂÖãÔºöËßÑÂàôÈÄüËßà</h2>

                <div class="beginner-tip" id="beginnerTip">
                    <h3 data-i18n="beginner.title">üöÄ Êñ∞ÊâãÂø´ÈÄüÂÖ•Èó®</h3>
                    <div class="tip-content">
                        <p data-i18n="beginner.intro">Á¨¨‰∏ÄÊ¨°‰ΩøÁî®ÔºüÊåâ‰ª•‰∏ãÊ≠•È™§ÂºÄÂßãÔºö</p>
                        <ol class="beginner-steps">
                            <li data-i18n="beginner.step1">ÈÄâÊã©Â∫ïÁâåÔºöÁÇπÂáªÂ∑¶Ëæπ"‰Ω†ÁöÑÂ∫ïÁâå"Âå∫ÂüüÁöÑÁ©∫ÊßΩÔºåÁÑ∂Âêé‰ªé‰∏ãÊñπÁâåÂ†ÜÈÄâÊã©‰∏§Âº†Áâå</li>
                            <li data-i18n="beginner.step2">ËÆæÁΩÆÈò∂ÊÆµÔºöÈÄâÊã©ÂΩìÂâçÊ∏∏ÊàèÈò∂ÊÆµÔºàÂª∫ËÆÆÊñ∞Êâã‰ªé"ÁøªÂâç"ÂºÄÂßãÔºâ</li>
                            <li data-i18n="beginner.step3">ËæìÂÖ•ÂèÇÊï∞ÔºöËÆæÁΩÆÂ∫ïÊ±†100„ÄÅË∑üÊ≥®20„ÄÅÂèåÊñπÁ≠πÁ†ÅÂêÑ500</li>
                            <li data-i18n="beginner.step4">ÈÄâÊã©‰ΩçÁΩÆÔºöÂ¶Ç‰∏çÁ°ÆÂÆöÈÄâÊã©"ÊåâÈíÆ‰Ωç(BTN)"</li>
                            <li data-i18n="beginner.step5">Ëé∑ÂèñÂª∫ËÆÆÔºöÁÇπÂáª"Ëé∑ÂèñÂÜ≥Á≠ñÂª∫ËÆÆ"Êü•ÁúãÊé®ËçêË°åÂä®</li>
                        </ol>
                        <button class="dismiss-tip" id="dismissTip" data-i18n="beginner.dismiss">ÊàëÁü•ÈÅì‰∫Ü</button>
                    </div>
                </div>

                <div class="lesson-list">
                    <div class="lesson-item">
                        <strong data-i18n="lesson.goal.title">Ê†∏ÂøÉÁõÆÊ†á</strong>
                        <span data-i18n="lesson.goal.copy">ÈÄöËøáÊëäÁâåËµ¢ÂæóÊúÄÂ§ßÊàêÊâãÁâåÔºåÊàñËÆ©ÊâÄÊúâÂØπÊâãÂºÉÁâåÔºåÂ§∫ÂèñÂ∫ïÊ±†„ÄÇ</span>
                    </div>
                    <div class="lesson-item">
                        <strong data-i18n="lesson.structure.title">‰∏ÄÂ±ÄÊµÅÁ®ã</strong>
                        <span data-i18n="lesson.structure.copy">‰∏§Âº†Â∫ïÁâåËµ∑ÊâãÔºåÁõ≤Ê≥®ÂÅöÂ∫ïÔºåÂÖ¨ÂÖ±Áâå‰æùÊ¨°ÁøªÁâåÂúà„ÄÅËΩ¨ÁâåÂúà„ÄÅÊ≤≥ÁâåÂúà‰∫ÆÂá∫ÔºåÊúÄÂ§öÂõõËΩÆ‰∏ãÊ≥®„ÄÇ</span>
                    </div>
                    <div class="lesson-item">
                        <strong data-i18n="lesson.position.title">‰ΩçÁΩÆ‰∏é‰ø°ÊÅØ</strong>
                        <span data-i18n="lesson.position.copy">ÊåâÈíÆ‰ΩçÊúÄÂêéË°åÂä®‰ºòÂäøÊúÄÂ§ßÔºåÁõ≤Ê≥®‰ΩçÁΩÆÁøªÁâåÂêéÈúÄÁéáÂÖàË°åÂä®„ÄÇ</span>
                    </div>
                    <div class="lesson-item">
                        <strong data-i18n="lesson.strategy.title">ÈáèÂåñÊÄùÁª¥</strong>
                        <span data-i18n="lesson.strategy.copy">ËÉúÁéá„ÄÅÂ∫ïÊ±†ËµîÁéá„ÄÅÈ£éÈô©ÂÅèÂ•ΩÂÖ±ÂêåÈ©±Âä®ÂÜ≥Á≠ñÔºå‰øùÊåÅÁ∫™ÂæãÔºåÈÅøÂÖçÊÉÖÁª™Âåñ„ÄÇ</span>
                    </div>
                </div>

                <div class="cheatsheet">
                    <h3 data-i18n="lesson.cheatsheet.title">ÁâåÊ°åÈÄüÊü•ÂÆùÂÖ∏</h3>
                    <div class="cheatsheet-grid">
                        <div class="cheatsheet-card">
                            <div class="cheatsheet-label" data-i18n="lesson.cheatsheet.preflop">ÁøªÂâçÂè£‰ª§</div>
                            <ul>
                                <li data-i18n="lesson.cheatsheet.preflop1">ÊåâÈíÆ‰Ωç 3x ÂºÄÂ±ÄÔºåÂÆΩÊùæÂÅ∑Áõ≤</li>
                                <li data-i18n="lesson.cheatsheet.preflop2">Ââç‰ΩçÁ¥ßÂá∂ÔºöÈ°∂Á∫ßÂØπÂ≠ê + Âº∫ÂêåËä±ËøûÁâå</li>
                                <li data-i18n="lesson.cheatsheet.preflop3">Â§ßÁõ≤Èò≤ÂÆàÔºöËµîÁéá ‚â• 3:1 ÊâçË∑üÊ≥®</li>
                            </ul>
                        </div>
                        <div class="cheatsheet-card">
                            <div class="cheatsheet-label" data-i18n="lesson.cheatsheet.flop">ÁøªÁâåËØªÁâå</div>
                            <ul>
                                <li data-i18n="lesson.cheatsheet.flop1">Âπ≤Áá•ÊùøÔºö‰∏≠Á≠âÂØπÂ≠êÂèØÊåÅÁª≠‰∏ãÊ≥®</li>
                                <li data-i18n="lesson.cheatsheet.flop2">ÊπøÊ∂¶ÊùøÔºö‰ºòÂÖà‰øùÊä§ÔºåÂáèÂ∞è‰∏ãÊ≥®Â∞∫Â∫¶</li>
                                <li data-i18n="lesson.cheatsheet.flop3">‰∏≠È°∫/ÂêåËä±Âê¨ÁâåÔºöËÆ°ÁÆóË°•Áâå √ó4 Ê¶ÇÁéá</li>
                            </ul>
                        </div>
                        <div class="cheatsheet-card">
                            <div class="cheatsheet-label" data-i18n="lesson.cheatsheet.turn">ËΩ¨ÁâåÂÜ≥Á≠ñ</div>
                            <ul>
                                <li data-i18n="lesson.cheatsheet.turn1">SPR &lt; 1.5ÔºöÁâåÂäõÂ§üÂº∫ÂèØÁõ¥Êé•ÊäïÂÖ•</li>
                                <li data-i18n="lesson.cheatsheet.turn2">ÂØπÊâãÂä†Ê≥® => ËØÑ‰º∞ËåÉÂõ¥‰ºòÂäøÊòØÂê¶ÂèçËΩ¨</li>
                                <li data-i18n="lesson.cheatsheet.turn3">ÂçäËØàÂî¨ÈúÄ‰øùËØÅÂºÉÁâåÁéá √ó Â∫ïÊ±† ‚â• ÊàêÊú¨</li>
                            </ul>
                        </div>
                        <div class="cheatsheet-card">
                            <div class="cheatsheet-label" data-i18n="lesson.cheatsheet.river">Ê≤≥ÁâåÊâßË°å</div>
                            <ul>
                                <li data-i18n="lesson.cheatsheet.river1">‰ª∑ÂÄº‰∏ãÊ≥®ÔºöËÉΩË¢´Êõ¥Â∑ÆÁöÑÁâåË∑üÊ≥®Ôºü</li>
                                <li data-i18n="lesson.cheatsheet.river2">Á≤æÂáÜËØàÂî¨Ôºö‰ª£Ë°®Âº∫Áâå + ÈòªÊñ≠ÂØπÊâãÂÖ≥ÈîÆÁâå</li>
                                <li data-i18n="lesson.cheatsheet.river3">ÈîôËøáÂê¨Áâå ‚Üí ÊùÉË°°ÂºÉÁâåÁéá / ÊëäÁâå‰ª∑ÂÄº</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <section class="panel" id="statePanel">
                <div class="section">
                    <h2 data-i18n="state.heading">ÁâåÂ±ÄËÆæÁΩÆ</h2>
                    <div class="stage-options" id="streetOptions">
                        <label data-street="PREFLOP" class="active">
                            <input type="radio" name="street" value="PREFLOP" checked>
                            <span data-i18n="streets.PREFLOP">ÁøªÂâç (Preflop)</span>
                        </label>
                        <label data-street="FLOP">
                            <input type="radio" name="street" value="FLOP">
                            <span data-i18n="streets.FLOP">ÁøªÁâåÂúà (Flop)</span>
                        </label>
                        <label data-street="TURN">
                            <input type="radio" name="street" value="TURN">
                            <span data-i18n="streets.TURN">ËΩ¨ÁâåÂúà (Turn)</span>
                        </label>
                        <label data-street="RIVER">
                            <input type="radio" name="street" value="RIVER">
                            <span data-i18n="streets.RIVER">Ê≤≥ÁâåÂúà (River)</span>
                        </label>
                    </div>
                </div>

                <div class="cards-grid">
                    <div class="section card-panel">
                        <h3 data-i18n="state.hero">‰Ω†ÁöÑÂ∫ïÁâå</h3>
                        <div class="card-slots" id="heroSlots"></div>
                    </div>
                    <div class="section card-panel">
                        <h3 data-i18n="state.board">ÂÖ¨ÂÖ±Áâå</h3>
                        <div class="card-slots" id="boardSlots"></div>
                    </div>
                </div>

                <div class="section deck-section" id="deckSection">
                    <h3 data-i18n="deck.heading">ÁâåÂ†ÜÔºàÁÇπÂáªÈÄâÁâåÔºâ</h3>
                    <p class="deck-hint" data-i18n="deck.hint">ÂÖàÁÇπÂáªÁ©∫ÊßΩÂÜçÁÇπÈÄâÂç°ÁâåÔºõÂ∑≤ÈÄâÂç°Áâå‰ºöËá™Âä®ÁÅ∞ÂåñÔºåÁÇπÂáªÊßΩ‰ΩçÂè≥‰∏äËßíÂèØÊ∏ÖÈô§„ÄÇ</p>
                    <div class="deck-grid" id="deckGrid"></div>
                </div>

                <div class="section">
                    <h3 data-i18n="state.parameters">Á≠πÁ†Å‰∏éÂèÇÊï∞</h3>
                    <div class="inputs-grid">
                        <label class="field-label">
                            <span data-i18n="fields.pot">Â∫ïÊ±†Â§ßÂ∞è</span>
                            <input type="number" id="potInput" min="0" step="0.01" value="100" data-i18n-placeholder="placeholders.pot">
                        </label>
                        <label class="field-label">
                            <span data-i18n="fields.toCall">ÈúÄË¶ÅË∑üÊ≥®</span>
                            <input type="number" id="toCallInput" min="0" step="0.01" value="10" data-i18n-placeholder="placeholders.toCall">
                        </label>
                        <label class="field-label">
                            <span data-i18n="fields.heroStack">‰Ω†ÁöÑÁ≠πÁ†Å</span>
                            <input type="number" id="heroStackInput" min="0" step="0.01" value="500" data-i18n-placeholder="placeholders.heroStack">
                        </label>
                        <label class="field-label">
                            <span data-i18n="fields.villainStack">ÂØπÊâãÁ≠πÁ†Å</span>
                            <input type="number" id="villainStackInput" min="0" step="0.01" value="500" data-i18n-placeholder="placeholders.villainStack">
                        </label>
                        <label class="field-label">
                            <span data-i18n="fields.numOpponents">Âú®Â±ÄÂØπÊâãÊï∞</span>
                            <input type="number" id="numOpponentsInput" min="1" max="8" value="1">
                        </label>
                        <label class="field-label">
                            <span data-i18n="fields.position">‰Ω†ÁöÑ‰ΩçÁΩÆ</span>
                            <select id="positionSelect"></select>
                        </label>
                        <label class="field-label">
                            <span data-i18n="fields.villainRange">ÂØπÊâãËåÉÂõ¥</span>
                            <input type="text" id="rangeInput" data-i18n-placeholder="placeholders.villainRange" placeholder="AA,KK,QQ,AKs">
                        </label>
                    </div>

                    <div class="slider-row">
                        <span data-i18n="risk.conservative">‰øùÂÆà</span>
                        <input type="range" id="riskSlider" min="0" max="10" value="5">
                        <span data-i18n="risk.aggressive">ÊøÄËøõ</span>
                        <strong id="riskValue">5</strong>
                    </div>
                </div>

                <div class="button-group">
                    <button id="recommendButton" data-i18n="buttons.recommend">Ëé∑ÂèñÂÜ≥Á≠ñÂª∫ËÆÆ</button>
                    <button id="equityButton" data-i18n="buttons.equity">‰ªÖËÆ°ÁÆóËÉúÁéá</button>
                    <button id="resetButton" class="ghost" data-i18n="buttons.reset">ÈáçÁΩÆÁâåÈù¢</button>
                </div>

                <div class="error-box" id="errorBox"></div>
            </section>
            <section class="analysis-panel" id="analysisPanel">
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <span data-i18n="loading">Ê≠£Âú®‰∏∫‰Ω†ÈáèÂåñÁâåÂ±Ä...</span>
                </div>

                <div class="opponent-callout" id="opponentCallout">
                    <div class="opponent-callout-text">
                        <span class="callout-label" data-i18n="opponent.heading">ÂØπÊâãÂª∫Ê®°</span>
                        <p data-i18n="opponent.calloutHint">Ê¢≥ÁêÜÂØπÊâãÁöÑÊâìÊ≥ïÁîªÂÉèÔºåÁ≥ªÁªü‰ºöÂç≥Êó∂Âà∑Êñ∞Á≠ñÁï•Âª∫ËÆÆ‰∏éÂØπÂ±ÄËß£ËØª„ÄÇ</p>
                    </div>
                    <button id="opponentModalBtn" class="callout-button" data-i18n="buttons.opponentConfig">ÈÖçÁΩÆÂØπÊâãÁîªÂÉè</button>
                </div>

                <div class="analysis-top">
                    <div class="analysis-metric">
                        <span class="analysis-metric-label" data-i18n="analysis.stage">ÂΩìÂâçÈò∂ÊÆµ</span>
                        <div class="analysis-metric-value" id="stageValue">-</div>
                    </div>
                    <div class="analysis-metric">
                        <span class="analysis-metric-label" data-i18n="analysis.risk">È£éÈô©ÂÅèÂ•Ω</span>
                        <div class="analysis-metric-value" id="riskMetricValue">-</div>
                    </div>
                    <div class="result-banner" id="resultBanner" style="display: none;">
                        <div class="analysis-metric">
                            <span class="analysis-metric-label" data-i18n="result.action">Êé®ËçêË°åÂä®</span>
                            <div class="analysis-metric-value" id="actionValue">-</div>
                        </div>
                        <div class="analysis-metric">
                            <span class="analysis-metric-label" data-i18n="result.confidence">ÁΩÆ‰ø°Â∫¶</span>
                            <div class="analysis-metric-value" id="confidenceValue">-</div>
                        </div>
                        <div class="analysis-metric">
                            <span class="analysis-metric-label" data-i18n="result.ev">È¢ÑÊúüÁõàÂà©</span>
                            <div class="analysis-metric-value" id="evValue">-</div>
                        </div>
                    </div>
                </div>

                <div class="analysis-overview">
                    <div class="overview-card">
                        <div class="overview-title" data-i18n="analysis.quick.cards">ÁâåÈù¢Ê¶ÇËßà</div>
                        <div class="overview-items">
                            <div class="overview-item">
                                <span data-i18n="analysis.hero">‰Ω†ÁöÑÂ∫ïÁâå</span>
                                <div class="badge-row" id="analysisHeroCards"></div>
                            </div>
                            <div class="overview-item">
                                <span data-i18n="analysis.board">ÂÖ¨ÂÖ±Áâå</span>
                                <div class="badge-row" id="analysisBoardCards"></div>
                            </div>
                        </div>
                    </div>
                    <div class="overview-actions">
                        <button class="overview-button" id="analysisSummaryBtn">
                            <span data-i18n="analysis.quick.summary">Êü•ÁúãËæìÂÖ•ÊÄªËßà</span>
                            <span class="hint" data-i18n="analysis.quick.summaryHint">Summary</span>
                        </button>
                        <button class="overview-button" id="analysisStrategyBtn">
                            <span data-i18n="analysis.quick.strategy">Á≠ñÁï•Ëß£ËØªËØ¶ÊÉÖ</span>
                            <span class="hint" data-i18n="analysis.quick.strategyHint">Playbook</span>
                        </button>
                        <button class="overview-button" id="analysisOpponentBtn">
                            <span data-i18n="analysis.quick.opponent">ÂØπÊâãÁîªÂÉèÊ¥ûÂØü</span>
                            <span class="hint" data-i18n="analysis.quick.opponentHint">Villain profile</span>
                        </button>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <div class="modal-overlay" id="analysisSummaryModal">
        <div class="modal-content medium">
            <div class="modal-header">
                <h2 class="modal-title" data-i18n="analysisModal.summaryTitle">ÂΩìÂâçËæìÂÖ•Ê¶ÇËßà</h2>
                <button class="modal-close" id="closeAnalysisSummary">&times;</button>
            </div>
            <div class="modal-body">
                <div class="analysis-box">
                    <div class="analysis-box-title" data-i18n="summary.heading">ÂΩìÂâçËæìÂÖ•Ê¶ÇËßà</div>
                    <div class="summary-grid" id="summaryGrid"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="analysisStrategyModal">
        <div class="modal-content medium">
            <div class="modal-header">
                <h2 class="modal-title" data-i18n="analysisModal.strategyTitle">Á≠ñÁï•Ëß£ËØª</h2>
                <button class="modal-close" id="closeAnalysisStrategy">&times;</button>
            </div>
            <div class="modal-body">
                <div class="analysis-box">
                    <div class="analysis-box-title" data-i18n="analysis.explanation">Á≠ñÁï•Ëß£ËØª</div>
                    <div class="explanation-box" id="explanationBox" style="display: none;"></div>
                </div>
                <div class="analysis-box">
                    <div class="analysis-box-title" data-i18n="factors.heading">ÂÖ≥ÈîÆÂõ†Â≠ê</div>
                    <div class="factors-grid" id="factorsGrid"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="analysisOpponentModal">
        <div class="modal-content wide">
            <div class="modal-header">
                <h2 class="modal-title" data-i18n="analysisModal.opponentTitle">ÂØπÊâãÁîªÂÉèÊ¥ûÂØü</h2>
                <button class="modal-close" id="closeAnalysisOpponent">&times;</button>
            </div>
            <div class="modal-body">
                <div class="analysis-box">
                    <div class="analysis-box-title" data-i18n="analysis.opponent">ÂØπÊâãÁîªÂÉè</div>
                    <div class="insights-panel" id="opponentInsights" style="display: none;">
                        <div class="insights-header">
                            <span class="archetype-pill" id="opponentArchetype"></span>
                        </div>
                        <p id="opponentSummary" style="font-size:0.92rem;line-height:1.6;opacity:0.82;margin-bottom:16px;"></p>
                        <div class="insight-cards">
                            <div class="insight-card">
                                <strong data-i18n="opponent.insights.aggression">ÊøÄËøõÊåáÊï∞</strong>
                                <span id="opponentAggressionMetric">-</span>
                            </div>
                            <div class="insight-card">
                                <strong data-i18n="opponent.insights.betting">‰∏ãÊ≥®ÂéãÂäõ</strong>
                                <span id="opponentBettingMetric">-</span>
                            </div>
                            <div class="insight-card">
                                <strong data-i18n="opponent.insights.psychology">ÂøÉÁêÜÂéãÂº∫</strong>
                                <span id="opponentPsychologyMetric">-</span>
                            </div>
                            <div class="insight-card">
                                <strong data-i18n="opponent.insights.range">ËåÉÂõ¥‰ºòÂäø</strong>
                                <span id="opponentRangeMetric">-</span>
                            </div>
                        </div>
                        <div class="insight-notes" id="opponentNotes"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ê∏∏ÊàèÊâãÂÜåÊ®°ÊÄÅÊ°Ü -->
    <div class="modal-overlay" id="gameManualModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" data-i18n="manual.title">Âæ∑Â∑ûÊâëÂÖãÊ∏∏ÊàèÊâãÂÜå</h2>
                <button class="modal-close" id="closeManualBtn">&times;</button>
            </div>

            <div class="manual-section">
                <h3 data-i18n="manual.basicRules">Âü∫Êú¨ËßÑÂàô</h3>
                <p data-i18n="manual.basicRulesText">Âæ∑Â∑ûÊâëÂÖãÔºàTexas Hold'emÔºâÊòØ‰∏ÄÁßçÊµÅË°åÁöÑÊâëÂÖãÂèò‰ΩìÔºåÊØè‰ΩçÁé©ÂÆ∂Âèë2Âº†Â∫ïÁâåÔºåÈÄöËøá‰∏é5Âº†ÂÖ¨ÂÖ±ÁâåÁªìÂêàÁªÑÊàêÊúÄ‰Ω≥ÁöÑ5Âº†ÁâåÂûã„ÄÇ</p>
            </div>

            <div class="manual-section">
                <h3 data-i18n="manual.gameFlow">Ê∏∏ÊàèÊµÅÁ®ã</h3>
                <ul>
                    <li><strong data-i18n="manual.preflop">ÁøªÂâçÔºàPre-flopÔºâ</strong>Ôºö<span data-i18n="manual.preflopDesc">ÊØè‰ΩçÁé©ÂÆ∂Ëé∑Âæó2Âº†Â∫ïÁâåÔºåÊ†πÊçÆÁâåÂäõÂÜ≥ÂÆöË∑üÊ≥®„ÄÅÂä†Ê≥®ÊàñÂºÉÁâå</span></li>
                    <li><strong data-i18n="manual.flop">ÁøªÁâåÔºàFlopÔºâ</strong>Ôºö<span data-i18n="manual.flopDesc">ÂèëÂá∫Ââç3Âº†ÂÖ¨ÂÖ±ÁâåÔºåËøõË°åÊñ∞‰∏ÄËΩÆ‰∏ãÊ≥®</span></li>
                    <li><strong data-i18n="manual.turn">ËΩ¨ÁâåÔºàTurnÔºâ</strong>Ôºö<span data-i18n="manual.turnDesc">ÂèëÂá∫Á¨¨4Âº†ÂÖ¨ÂÖ±ÁâåÔºåÁªßÁª≠‰∏ãÊ≥®</span></li>
                    <li><strong data-i18n="manual.river">Ê≤≥ÁâåÔºàRiverÔºâ</strong>Ôºö<span data-i18n="manual.riverDesc">ÂèëÂá∫Á¨¨5Âº†ÂÖ¨ÂÖ±ÁâåÔºåÊúÄÂêé‰∏ÄËΩÆ‰∏ãÊ≥®</span></li>
                    <li><strong data-i18n="manual.showdown">ÊëäÁâåÔºàShowdownÔºâ</strong>Ôºö<span data-i18n="manual.showdownDesc">ÊØîËæÉÁâåÂûãÂ§ßÂ∞èÔºåÊúÄÂ§ßÁâåÂûãËé∑ËÉú</span></li>
                </ul>
            </div>

            <div class="manual-section">
                <h3 data-i18n="manual.handRankings">ÁâåÂûãÊéíÂêçÔºà‰ªéÂ§ßÂà∞Â∞èÔºâ</h3>
                <div class="hand-rankings">
                    <div class="hand-rank">
                        <span class="hand-rank-name" data-i18n="manual.royalFlush">ÁöáÂÆ∂ÂêåËä±È°∫</span>
                        <span class="hand-rank-example">A‚ô† K‚ô† Q‚ô† J‚ô† 10‚ô†</span>
                    </div>
                    <div class="hand-rank">
                        <span class="hand-rank-name" data-i18n="manual.straightFlush">ÂêåËä±È°∫</span>
                        <span class="hand-rank-example">9‚ô• 8‚ô• 7‚ô• 6‚ô• 5‚ô•</span>
                    </div>
                    <div class="hand-rank">
                        <span class="hand-rank-name" data-i18n="manual.fourOfKind">ÂõõÊù°</span>
                        <span class="hand-rank-example">K‚ô£ K‚ô¶ K‚ô• K‚ô† 3‚ô¶</span>
                    </div>
                    <div class="hand-rank">
                        <span class="hand-rank-name" data-i18n="manual.fullHouse">Ëë´Ëä¶</span>
                        <span class="hand-rank-example">Q‚ô† Q‚ô• Q‚ô¶ 7‚ô£ 7‚ô†</span>
                    </div>
                    <div class="hand-rank">
                        <span class="hand-rank-name" data-i18n="manual.flush">ÂêåËä±</span>
                        <span class="hand-rank-example">A‚ô¶ J‚ô¶ 9‚ô¶ 6‚ô¶ 2‚ô¶</span>
                    </div>
                    <div class="hand-rank">
                        <span class="hand-rank-name" data-i18n="manual.straight">È°∫Â≠ê</span>
                        <span class="hand-rank-example">10‚ô† 9‚ô• 8‚ô¶ 7‚ô£ 6‚ô†</span>
                    </div>
                    <div class="hand-rank">
                        <span class="hand-rank-name" data-i18n="manual.threeOfKind">‰∏âÊù°</span>
                        <span class="hand-rank-example">8‚ô£ 8‚ô¶ 8‚ô• K‚ô† 4‚ô¶</span>
                    </div>
                    <div class="hand-rank">
                        <span class="hand-rank-name" data-i18n="manual.twoPair">‰∏§ÂØπ</span>
                        <span class="hand-rank-example">A‚ô† A‚ô• 5‚ô£ 5‚ô¶ 9‚ô†</span>
                    </div>
                    <div class="hand-rank">
                        <span class="hand-rank-name" data-i18n="manual.onePair">‰∏ÄÂØπ</span>
                        <span class="hand-rank-example">J‚ô¶ J‚ô† 10‚ô• 8‚ô£ 3‚ô¶</span>
                    </div>
                    <div class="hand-rank">
                        <span class="hand-rank-name" data-i18n="manual.highCard">È´òÁâå</span>
                        <span class="hand-rank-example">A‚ô† K‚ô¶ Q‚ô• 8‚ô£ 5‚ô†</span>
                    </div>
                </div>
            </div>

            <div class="manual-section">
                <h3 data-i18n="manual.keyConcepts">ÂÖ≥ÈîÆÊ¶ÇÂøµ</h3>
                <ul>
                    <li><strong data-i18n="manual.potOdds">Â∫ïÊ±†ËµîÁéáÔºàPot OddsÔºâ</strong>Ôºö<span data-i18n="manual.potOddsDesc">ÂΩìÂâçË∑üÊ≥®ÊâÄÈúÄÁ≠πÁ†Å‰∏éÂ∫ïÊ±†Â§ßÂ∞èÁöÑÊØî‰æã</span></li>
                    <li><strong data-i18n="manual.impliedOdds">ÈöêÂê´ËµîÁéáÔºàImplied OddsÔºâ</strong>Ôºö<span data-i18n="manual.impliedOddsDesc">ËÄÉËôëÂêéÁª≠ÂèØËÉΩËµ¢ÂæóÁ≠πÁ†ÅÁöÑËµîÁéá</span></li>
                    <li><strong data-i18n="manual.position">‰ΩçÁΩÆÔºàPositionÔºâ</strong>Ôºö<span data-i18n="manual.positionDesc">Áõ∏ÂØπ‰∫éÂ∫ÑÂÆ∂‰ΩçÁΩÆÔºåÂêé‰ΩçÁΩÆÊúâ‰ø°ÊÅØ‰ºòÂäø</span></li>
                    <li><strong data-i18n="manual.spr">Á≠πÁ†Å-Â∫ïÊ±†ÊØîÔºàSPRÔºâ</strong>Ôºö<span data-i18n="manual.sprDesc">ÊúâÊïàÁ≠πÁ†ÅÈô§‰ª•Â∫ïÊ±†Â§ßÂ∞è</span></li>
                    <li><strong data-i18n="manual.draws">Âê¨ÁâåÔºàDrawÔºâ</strong>Ôºö<span data-i18n="manual.drawsDesc">ÈúÄË¶ÅÁâπÂÆöÁâåÊâçËÉΩÊàêÁâåÁöÑÁâåÂûã</span></li>
                </ul>
            </div>

            <div class="manual-section">
                <h3 data-i18n="manual.positions">‰ΩçÁΩÆËØ¶Ëß£</h3>
                <p data-i18n="manual.positionsIntro">Âú®Âæ∑Â∑ûÊâëÂÖã‰∏≠Ôºå‰Ω†Áõ∏ÂØπ‰∫éÂ∫ÑÂÆ∂ÊåâÈíÆÁöÑ‰ΩçÁΩÆÂÜ≥ÂÆö‰∫ÜË°åÂä®È°∫Â∫èÔºåÊòØÂΩ±ÂìçÁ≠ñÁï•ÁöÑÂÖ≥ÈîÆÂõ†Á¥†Ôºö</p>

                <div class="position-categories">
                    <div class="position-category">
                        <h4 data-i18n="manual.earlyPositions">Ââç‰ΩçÔºàEarly PositionÔºâ- ÊúÄÂÖàË°åÂä®</h4>
                        <ul>
                            <li><strong data-i18n="manual.utg">UTGÔºàÊû™Âè£‰ΩçÔºâ</strong>Ôºö<span data-i18n="manual.utgDesc">ÁøªÂâçÁ¨¨‰∏Ä‰∏™Ë°åÂä®Ôºå‰ø°ÊÅØÊúÄÂ∞ëÔºåÈúÄË¶ÅÊúÄÂº∫ÁöÑÁâå</span></li>
                            <li><strong data-i18n="manual.utg1">UTG+1</strong>Ôºö<span data-i18n="manual.utg1Desc">Á¨¨‰∫å‰∏™Ë°åÂä®‰ΩçÁΩÆÔºå‰ªçÁÑ∂ÈúÄË¶ÅËæÉÂº∫ÊâãÁâå</span></li>
                            <li><strong data-i18n="manual.utg2">UTG+2</strong>Ôºö<span data-i18n="manual.utg2Desc">ÂèØ‰ª•Áï•ÂæÆÊîæÂÆΩÊâãÁâåË¶ÅÊ±Ç</span></li>
                        </ul>
                    </div>

                    <div class="position-category">
                        <h4 data-i18n="manual.middlePositions">‰∏≠‰ΩçÔºàMiddle PositionÔºâ</h4>
                        <ul>
                            <li><strong data-i18n="manual.mp1">MP1Ôºà‰∏≠Èó¥‰Ωç1Ôºâ</strong>Ôºö<span data-i18n="manual.mp1Desc">ÂèØ‰ª•Áé©Êõ¥Â§öËæπÈôÖÊâãÁâå</span></li>
                            <li><strong data-i18n="manual.mp2">MP2Ôºà‰∏≠Èó¥‰Ωç2Ôºâ</strong>Ôºö<span data-i18n="manual.mp2Desc">‰ΩçÁΩÆÂºÄÂßãÂèòÂæóÊúâÂà©</span></li>
                            <li><strong data-i18n="manual.mp3">MP3Ôºà‰∏≠Èó¥‰Ωç3Ôºâ</strong>Ôºö<span data-i18n="manual.mp3Desc">Êé•ËøëÊôö‰ΩçÁöÑ‰ºòÂäø</span></li>
                        </ul>
                    </div>

                    <div class="position-category">
                        <h4 data-i18n="manual.latePositions">Âêé‰ΩçÔºàLate PositionÔºâ- ‰ø°ÊÅØ‰ºòÂäø</h4>
                        <ul>
                            <li><strong data-i18n="manual.lj">LJÔºàÂä´Âå™‰ΩçÔºâ</strong>Ôºö<span data-i18n="manual.ljDesc">ÂèØ‰ª•ËßÇÂØüÂâçÈù¢Áé©ÂÆ∂Ë°åÂä®ÂêéÂÜ≥Á≠ñ</span></li>
                            <li><strong data-i18n="manual.hj">HJÔºàÂä´ÊåÅ‰ΩçÔºâ</strong>Ôºö<span data-i18n="manual.hjDesc">ÈùûÂ∏∏ÊúâÂà©ÁöÑ‰ΩçÁΩÆÔºåÂèØ‰ª•ÂÅ∑Áõ≤</span></li>
                            <li><strong data-i18n="manual.co">COÔºàÊà™Êñ≠‰ΩçÔºâ</strong>Ôºö<span data-i18n="manual.coDesc">‰ªÖÊ¨°‰∫éÊåâÈíÆ‰ΩçÁöÑ‰ºòÂäø‰ΩçÁΩÆ</span></li>
                            <li><strong data-i18n="manual.btn">BTNÔºàÊåâÈíÆ‰ΩçÔºâ</strong>Ôºö<span data-i18n="manual.btnDesc">ÁøªÂêéÊ∞∏ËøúÊúÄÂêéË°åÂä®ÔºåÊúÄ‰Ω≥‰ΩçÁΩÆ</span></li>
                        </ul>
                    </div>

                    <div class="position-category">
                        <h4 data-i18n="manual.blindPositions">Áõ≤Ê≥®‰ΩçÔºàBlind PositionsÔºâ</h4>
                        <ul>
                            <li><strong data-i18n="manual.sb">SBÔºàÂ∞èÁõ≤‰ΩçÔºâ</strong>Ôºö<span data-i18n="manual.sbDesc">ÁøªÂêéÁ¨¨‰∏Ä‰∏™Ë°åÂä®Ôºå‰ΩçÁΩÆÊúÄÂ∑Æ‰ΩÜÂ∑≤ÊäïÂÖ•‰∏ÄÂçäÂ§ßÁõ≤</span></li>
                            <li><strong data-i18n="manual.bb">BBÔºàÂ§ßÁõ≤‰ΩçÔºâ</strong>Ôºö<span data-i18n="manual.bbDesc">ÁøªÂâçÊúÄÂêéË°åÂä®ÔºåÁøªÂêéÁ¨¨‰∫å‰∏™Ë°åÂä®</span></li>
                        </ul>
                    </div>
                </div>

            <div class="position-tips">
                <h4 data-i18n="manual.positionStrategy">‰ΩçÁΩÆÁ≠ñÁï•Ë¶ÅÁÇπ</h4>
                <ul>
                    <li data-i18n="manual.tip1">Ââç‰ΩçÈúÄË¶ÅÊõ¥Âº∫ÁöÑËµ∑ÊâãÁâåÔºåÂõ†‰∏∫ÂêéÈù¢ËøòÊúâÂæàÂ§öÁé©ÂÆ∂Ë¶ÅË°åÂä®</li>
                    <li data-i18n="manual.tip2">Âêé‰ΩçÂèØ‰ª•Áé©Êõ¥Â§öÊäïÊú∫ÊÄßÊâãÁâåÔºåËßÇÂØüÂØπÊâãË°åÂä®ÂêéÂÜçÂÜ≥Á≠ñ</li>
                        <li data-i18n="manual.tip3">ÊåâÈíÆ‰ΩçÊòØÊúÄÊúâÂà©‰ΩçÁΩÆÔºåÂèØ‰ª•Áî®Êõ¥ÂÆΩÁöÑËåÉÂõ¥Âä†Ê≥®ÂíåÂÅ∑Áõ≤</li>
                        <li data-i18n="manual.tip4">Áõ≤Ê≥®‰ΩçÁΩÆÁøªÂêé‰∏çÂà©Ôºå‰ΩÜÁøªÂâçÂ∑≤ÊúâÊäïÂÖ•Ë¶ÅËÄÉËôëÂ∫ïÊ±†ËµîÁéá</li>
                    </ul>
                </div>
            </div>

            <div class="manual-section">
                <h3 data-i18n="manual.strategies">Â∏∏Áî®Á≠ñÁï•Ê¶ÇÂøµ</h3>
                <ul>
                    <li><strong data-i18n="manual.tag">Á¥ßÂá∂ÔºàTAGÔºâ</strong>Ôºö<span data-i18n="manual.tagDesc">Âè™Áé©Âº∫Áâå‰ΩÜÁé©ÂæóÊøÄËøõ</span></li>
                    <li><strong data-i18n="manual.lag">ÊùæÂá∂ÔºàLAGÔºâ</strong>Ôºö<span data-i18n="manual.lagDesc">Áé©ËæÉÂ§öÁâåÂûã‰∏îÊøÄËøõ‰∏ãÊ≥®</span></li>
                    <li><strong data-i18n="manual.valueBet">‰ª∑ÂÄº‰∏ãÊ≥®</strong>Ôºö<span data-i18n="manual.valueBetDesc">ÊúâÂº∫ÁâåÊó∂‰∏ãÊ≥®Ëé∑Âèñ‰ª∑ÂÄº</span></li>
                    <li><strong data-i18n="manual.bluff">ËØàÂî¨ÔºàBluffÔºâ</strong>Ôºö<span data-i18n="manual.bluffDesc">Áî®Âº±Áâå‰∏ãÊ≥®Ëø´‰ΩøÂØπÊâãÂºÉÁâå</span></li>
                    <li><strong data-i18n="manual.semiBluff">ÂçäËØàÂî¨</strong>Ôºö<span data-i18n="manual.semiBluffDesc">Áî®Âê¨Áâå‰∏ãÊ≥®ÔºåÊó¢ÂèØËÉΩÊàêÁâå‰πüÂèØËÉΩËÆ©ÂØπÊâãÂºÉÁâå</span></li>
                </ul>
            </div>

            <div class="manual-section">
                <h3 data-i18n="manual.startingHands">Êñ∞ÊâãËµ∑ÊâãÁâåÂª∫ËÆÆ</h3>
                <p data-i18n="manual.startingHandsIntro">‰Ωú‰∏∫Êñ∞ÊâãÔºåÂª∫ËÆÆÂè™Áé©‰ª•‰∏ãÂº∫ÁâåÔºåÈÅøÂÖçÂ§çÊùÇÂÜ≥Á≠ñÔºö</p>

                <div class="hand-categories">
                    <div class="hand-category premium">
                        <h4 data-i18n="manual.premiumHands">È°∂Á∫ßÂº∫ÁâåÔºà‰ªª‰Ωï‰ΩçÁΩÆÈÉΩÂèØ‰ª•Áé©Ôºâ</h4>
                        <div class="hand-examples">
                            <span class="hand-example">AA</span>
                            <span class="hand-example">KK</span>
                            <span class="hand-example">QQ</span>
                            <span class="hand-example">AKs</span>
                            <span class="hand-example">AKo</span>
                        </div>
                    </div>

                    <div class="hand-category strong">
                        <h4 data-i18n="manual.strongHands">Âº∫ÁâåÔºà‰∏≠Âêé‰ΩçÂèØ‰ª•Áé©Ôºâ</h4>
                        <div class="hand-examples">
                            <span class="hand-example">JJ</span>
                            <span class="hand-example">TT</span>
                            <span class="hand-example">99</span>
                            <span class="hand-example">AQs</span>
                            <span class="hand-example">AQo</span>
                            <span class="hand-example">AJs</span>
                            <span class="hand-example">KQs</span>
                        </div>
                    </div>

                    <div class="hand-category speculative">
                        <h4 data-i18n="manual.speculativeHands">ÊäïÊú∫ÁâåÔºà‰ªÖÂêé‰ΩçËÄÉËôëÔºâ</h4>
                        <div class="hand-examples">
                            <span class="hand-example">88-22</span>
                            <span class="hand-example">ATs</span>
                            <span class="hand-example">A9s-A2s</span>
                            <span class="hand-example">KJs</span>
                            <span class="hand-example">QJs</span>
                            <span class="hand-example">JTs</span>
                        </div>
                    </div>
                </div>

                <div class="hand-tips">
                    <p data-i18n="manual.handTips">üí° "s"Ë°®Á§∫ÂêåËä±Ëâ≤Ôºå"o"Ë°®Á§∫‰∏çÂêåËä±Ëâ≤„ÄÇÊñ∞ÊâãÂª∫ËÆÆÔºöÂâç‰ΩçÂè™Áé©È°∂Á∫ßÂº∫ÁâåÔºåÂêé‰ΩçÂèØ‰ª•ÈÄÇÂΩìÊîæÂÆΩ„ÄÇ</p>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="opponentModal">
        <div class="modal-content compact">
            <div class="modal-header">
                <h2 class="modal-title" data-i18n="opponentModal.title">ÂØπÊâãÁîªÂÉèÈÖçÁΩÆ</h2>
                <button class="modal-close" id="closeOpponentModal">&times;</button>
            </div>

            <div class="modal-body">
                <div class="opponent-layout">
                    <div class="trait-grid">
                        <div class="metric-group metric-slider">
                            <div class="metric-header">
                                <span data-i18n="opponent.aggression.label">ÊøÄËøõÁ®ãÂ∫¶</span>
                                <strong class="metric-value" id="opAggressionValue">6/10</strong>
                            </div>
                            <div class="metric-scale">
                                <small data-i18n="opponent.aggression.low">Ë¢´Âä®</small>
                                <input type="range" id="opAggressionInput" min="0" max="10" value="6">
                                <small data-i18n="opponent.aggression.high">ÊøÄËøõ</small>
                            </div>
                        </div>
                        <div class="metric-group metric-slider">
                            <div class="metric-header">
                                <span data-i18n="opponent.tightness.label">Ëµ∑ÊâãËåÉÂõ¥</span>
                                <strong class="metric-value" id="opTightnessValue">5/10</strong>
                            </div>
                            <div class="metric-scale">
                                <small data-i18n="opponent.tightness.wide">ÂÆΩÊùæ</small>
                                <input type="range" id="opTightnessInput" min="0" max="10" value="5">
                                <small data-i18n="opponent.tightness.narrow">Á¥ßÂÆû</small>
                            </div>
                        </div>
                        <div class="metric-group metric-slider">
                            <div class="metric-header">
                                <span data-i18n="opponent.bluff.label">ËØàÂî¨È¢ëÁéá</span>
                                <strong class="metric-value" id="opBluffValue">3/10</strong>
                            </div>
                            <div class="metric-scale">
                                <small data-i18n="opponent.bluff.low">ÁΩïËßÅ</small>
                                <input type="range" id="opBluffInput" min="0" max="10" value="3">
                                <small data-i18n="opponent.bluff.high">È¢ëÁπÅ</small>
                            </div>
                        </div>
                        <div class="metric-group metric-slider">
                            <div class="metric-header">
                                <span data-i18n="opponent.confidence.label">Ê°åÈù¢Ëá™‰ø°</span>
                                <strong class="metric-value" id="opConfidenceValue">6/10</strong>
                            </div>
                            <div class="metric-scale">
                                <small data-i18n="opponent.confidence.low">ÁäπË±´</small>
                                <input type="range" id="opConfidenceInput" min="0" max="10" value="6">
                                <small data-i18n="opponent.confidence.high">Ëá™‰ø°</small>
                            </div>
                        </div>
                        <div class="metric-group metric-slider">
                            <div class="metric-header">
                                <span data-i18n="opponent.tilt.label">ÊÉÖÁª™Ê≥¢Âä®</span>
                                <strong class="metric-value" id="opTiltValue">4/10</strong>
                            </div>
                            <div class="metric-scale">
                                <small data-i18n="opponent.tilt.calm">ÂÜ∑Èùô</small>
                                <input type="range" id="opTiltInput" min="0" max="10" value="4">
                                <small data-i18n="opponent.tilt.hot">Êé•ËøëÂ§±Êéß</small>
                            </div>
                        </div>
                    </div>
                    <div class="detail-column">
                        <div class="metric-group metric-field">
                            <span data-i18n="opponent.bet.label">ÊúÄËøë‰∏ãÊ≥®Âç†Â∫ïÊ±†%</span>
                            <input type="number" id="opBetPctInput" min="0" max="400" step="1" value="65" data-i18n-placeholder="opponent.bet.placeholder" placeholder="‰æãÂ¶Ç 70">
                        </div>
                        <div class="metric-group metric-action">
                            <span data-i18n="opponent.action.label">ÊúÄËøëÂä®‰Ωú</span>
                            <div class="action-grid">
                                <select id="opActionStreet">
                                    <option value="PREFLOP" data-i18n="streets.PREFLOP">ÁøªÂâç (Preflop)</option>
                                    <option value="FLOP" data-i18n="streets.FLOP">ÁøªÁâåÂúà (Flop)</option>
                                    <option value="TURN" data-i18n="streets.TURN">ËΩ¨ÁâåÂúà (Turn)</option>
                                    <option value="RIVER" data-i18n="streets.RIVER">Ê≤≥ÁâåÂúà (River)</option>
                                </select>
                                <select id="opActionType">
                                    <option value="bet" data-i18n="opponent.action.bet">‰∏ãÊ≥®</option>
                                    <option value="raise" data-i18n="opponent.action.raise">Âä†Ê≥®</option>
                                    <option value="call" data-i18n="opponent.action.call">Ë∑üÊ≥®</option>
                                    <option value="check" data-i18n="opponent.action.check">ËøáÁâå</option>
                                </select>
                                <input type="number" id="opActionAmount" min="0" step="0.01" data-i18n-placeholder="opponent.action.amount" placeholder="‰æãÂ¶Ç 80">
                                <input type="number" id="opActionPot" min="0" step="0.01" data-i18n-placeholder="opponent.action.pot" placeholder="Ë°åÂä®ÂâçÂ∫ïÊ±†">
                            </div>
                        </div>
                        <div class="metric-group metric-notes">
                            <span data-i18n="opponent.notes.label">È¢ùÂ§ñÂ§áÊ≥®</span>
                            <textarea id="opNotesInput" data-i18n-placeholder="opponent.notes.placeholder" placeholder="‰æãÂ¶ÇÔºöÁøªÁâåÂúàÊåÅÁª≠‰∏ãÊ≥®ÔºåÊ≤≥ÁâåË∂ã‰∫éÁ¥ßÂá∂"></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-actions">
                <button id="opponentModalCancel" data-i18n="opponentModal.cancel">ÂèñÊ∂à</button>
                <button id="opponentModalSave" class="primary" data-i18n="opponentModal.apply">Â∫îÁî®ËÆæÁΩÆ</button>
            </div>
        </div>
    </div>

    <script>
        const API_STORAGE_KEY = 'qpds.apiBaseUrl';
        const API_QUERY_PARAM = 'api';
        const LOCAL_API_URL = 'http://localhost:8080';
        const GITHUB_DEFAULT_API_URL = 'https://qpds-backend.onrender.com';

        function sanitizeApiUrl(url) {
            if (!url) {
                return null;
            }
            try {
                const parsed = new URL(url);
                if (!['http:', 'https:'].includes(parsed.protocol)) {
                    return null;
                }
                return parsed.origin;
            } catch (error) {
                return null;
            }
        }

        function resolveDefaultApiUrl() {
            if (window.location.hostname.endsWith('github.io')) {
                return GITHUB_DEFAULT_API_URL;
            }
            const override = sanitizeApiUrl(window.API_BASE_URL);
            if (override) {
                return override;
            }
            return LOCAL_API_URL;
        }

        function resolveApiUrl({ skipQuery = false } = {}) {
            if (!skipQuery) {
                const params = new URLSearchParams(window.location.search);
                const fromQuery = sanitizeApiUrl(params.get(API_QUERY_PARAM));
                if (fromQuery) {
                    params.delete(API_QUERY_PARAM);
                    const nextQuery = params.toString();
                    const nextUrl = `${window.location.pathname}${nextQuery ? `?${nextQuery}` : ''}${window.location.hash}`;
                    window.history.replaceState({}, '', nextUrl);
                    localStorage.setItem(API_STORAGE_KEY, fromQuery);
                    return fromQuery;
                }
            }

            const stored = sanitizeApiUrl(localStorage.getItem(API_STORAGE_KEY));
            if (stored) {
                return stored;
            }

            return resolveDefaultApiUrl();
        }

        let API_URL = resolveApiUrl();

        let deckGrid;
        let heroSlots;
        let boardSlots;
        let streetOptions;
        let positionSelect;
        let riskSlider;
        let riskValue;
        let langToggle;
        let apiConfigBtn;
        let apiStatusLabel;
        let loadingIndicator;
        let actionValue;
        let confidenceValue;
        let evValue;
        let resultBanner;
        let explanationBox;
        let factorsGrid;
        let errorBox;
        let summaryGrid;
        let opponentInsightsPanel;
        let opponentArchetype;
        let opponentSummary;
        let opponentNotesContainer;
        let opponentAggressionMetric;
        let opponentBettingMetric;
        let opponentPsychologyMetric;
        let opponentRangeMetric;
        let stageValueEl;
        let riskMetricValueEl;
        let analysisHeroCards;
        let analysisBoardCards;
        let analysisSummaryModal;
        let analysisStrategyModal;
        let analysisOpponentModal;
        let closeAnalysisSummaryBtn;
        let closeAnalysisStrategyBtn;
        let closeAnalysisOpponentBtn;
        let analysisSummaryBtn;
        let analysisStrategyBtn;
        let analysisOpponentBtn;
        let numOpponentsInput;
        let opponentModal;
        let opponentModalBtn;
        let opponentModalClose;
        let opponentModalCancel;
        let opponentModalSave;
        let opponentDraft = null;
        let opAggressionInput;
        let opTightnessInput;
        let opBluffInput;
        let opConfidenceInput;
        let opTiltInput;
        let opBetPctInput;
        let opActionStreet;
        let opActionType;
        let opActionAmount;
        let opActionPot;
        let opNotesInput;
        let opAggressionValue;
        let opTightnessValue;
        let opBluffValue;
        let opConfidenceValue;
        let opTiltValue;

        const translations = {
            en: {
                title: 'QPDS',
                subtitle: 'Quantitative Poker Decision System',
                beginner: {
                    title: 'üöÄ Quick Start Guide',
                    intro: 'First time using? Follow these steps:',
                    step1: 'Select hole cards: Click empty slots under "Your Hole Cards", then choose two cards from deck below',
                    step2: 'Set stage: Choose current game stage (beginners should start with "Preflop")',
                    step3: 'Input parameters: Set pot 100, to call 20, both stacks 500',
                    step4: 'Choose position: If unsure, select "Button (BTN)"',
                    step5: 'Get recommendation: Click "Get Recommendation" to see suggested action',
                    dismiss: 'Got it!'
                },
                lesson: {
                    heading: 'No-Limit Texas Hold\'em Essentials',
                    goal: {
                        title: 'The Goal',
                        copy: 'Win chips either by showing the strongest five-card hand at showdown or by making everyone else fold.'
                    },
                    structure: {
                        title: 'Hand Structure',
                        copy: 'Two private cards per player, blinds create the pot, and up to four betting rounds across flop, turn, and river community cards.'
                    },
                    position: {
                        title: 'Position & Information',
                        copy: 'Button acts last post-flop and has the most information; blinds must act first on later streets.'
                    },
                    strategy: {
                        title: 'Quant Thinking',
                        copy: 'Equity, pot odds, and your risk slider drive disciplined, data-backed decisions.'
                    },
                    cheatsheet: {
                        title: 'Quick Ringside Cheatsheet',
                        preflop: 'Preflop Riff',
                        preflop1: 'Button: open 3x with wider range, steal blinds aggressively.',
                        preflop2: 'Early position: premium pairs + strong suited connectors only.',
                        preflop3: 'Big blind defense: call only if pot odds ‚â• 3:1.',
                        flop: 'Flop Reading',
                        flop1: 'Dry boards: continue betting with middle pairs to deny equity.',
                        flop2: 'Wet boards: protect your made hands, size down to control pot.',
                        flop3: 'Strong draws: count outs √ó4 to estimate hit probability.',
                        turn: 'Turn Decisions',
                        turn1: 'SPR < 1.5: strong hands can commit stacks.',
                        turn2: 'Facing raises: reassess range advantage before stacking off.',
                        turn3: 'Semi-bluff only if fold equity √ó pot ‚â• risked chips.',
                        river: 'River Execution',
                        river1: 'Value bets: only if worse hands can call you.',
                        river2: 'Bluffs: tell a coherent story and block villain‚Äôs top combos.',
                        river3: 'Missed draws: balance fold equity vs showdown value.'
                    }
                },
                state: {
                    heading: 'Game State',
                    hero: 'Your Hole Cards',
                    board: 'Community Cards',
                    parameters: 'Stacks & Inputs'
                },
                streets: {
                    PREFLOP: 'Preflop',
                    FLOP: 'Flop',
                    TURN: 'Turn',
                    RIVER: 'River'
                },
                fields: {
                    pot: 'Pot Size',
                    toCall: 'Bet to Call',
                    heroStack: 'Your Stack',
                    villainStack: 'Villain Stack',
                    numOpponents: 'Opponents',
                    position: 'Your Position',
                    villainRange: 'Villain Range'
                },
                summary: {
                    heading: 'Current Inputs',
                    items: {
                        pot: 'Pot Size',
                        toCall: 'Bet to Call',
                        heroStack: 'Your Stack',
                        villainStack: 'Villain Stack',
                        street: 'Street',
                        position: 'Position',
                        numOpponents: 'Opponents',
                        risk: 'Risk Preference',
                        opponentModel: 'Opponent Read'
                    }
                },
                placeholders: {
                    pot: 'e.g. 100',
                    toCall: 'e.g. 20',
                    heroStack: 'e.g. 500',
                    villainStack: 'e.g. 500',
                    villainRange: 'AA,KK,QQ,AKs'
                },
                risk: {
                    conservative: 'Conservative',
                    aggressive: 'Aggressive'
                },
                buttons: {
                    recommend: 'Get Recommendation',
                    equity: 'Equity Only',
                    reset: 'Reset Cards',
                    gameManual: 'üÉè Game Manual',
                    apiConfig: '‚öôÔ∏è API',
                    opponentConfig: 'Opponent Model'
                },
                opponent: {
                    heading: 'Opponent Model',
                    calloutHint: 'Tune villain tendencies so the recommendations stay on point.',
                    aggression: {
                        label: 'Aggression',
                        low: 'Passive',
                        high: 'Hyper aggressive'
                    },
                    tightness: {
                        label: 'Opening Range',
                        wide: 'Loose',
                        narrow: 'Tight'
                    },
                    bluff: {
                        label: 'Bluff Frequency',
                        low: 'Rare',
                        high: 'Frequent'
                    },
                    confidence: {
                        label: 'Table Confidence',
                        low: 'Hesitant',
                        high: 'Confident'
                    },
                    tilt: {
                        label: 'Emotional Tilt',
                        calm: 'Composed',
                        hot: 'Near tilt'
                    },
                    bet: {
                        label: 'Latest bet % of pot',
                        placeholder: 'e.g. 70'
                    },
                    action: {
                        label: 'Latest action',
                        bet: 'Bet',
                        raise: 'Raise',
                        call: 'Call',
                        check: 'Check',
                        amount: 'Action amount',
                        pot: 'Pot before action'
                    },
                    notes: {
                        label: 'Notes',
                        placeholder: 'e.g. C-bets flop, tight river calls'
                    },
                    insights: {
                        heading: 'Opponent Insights',
                        aggression: 'Aggression Index',
                        betting: 'Betting Pressure',
                        psychology: 'Psychological Pressure',
                        range: 'Range Advantage'
                    }
                },
                status: {
                    apiLabel: 'API',
                    checking: 'checking‚Ä¶',
                    connected: 'online',
                    failed: 'unreachable'
                },
                analysis: {
                    stage: 'Stage',
                    risk: 'Risk Preference',
                    cards: 'Table Cards',
                    hero: 'Hero Cards',
                    board: 'Board',
                    explanation: 'Strategy Breakdown',
                    opponent: 'Opponent Insights',
                    quick: {
                        cards: 'Table Snapshot',
                        summary: 'View Input Overview',
                        summaryHint: 'Summary',
                        strategy: 'Strategy Insights',
                        strategyHint: 'Playbook',
                        opponent: 'Opponent Insights',
                        opponentHint: 'Villain profile'
                    }
                },
                analysisModal: {
                    summaryTitle: 'Input Overview',
                    strategyTitle: 'Strategy Breakdown',
                    opponentTitle: 'Opponent Insights'
                },
                prompts: {
                    apiBase: 'Enter backend API base URL (https://your-service.onrender.com)',
                    apiBaseInvalid: 'Please enter a valid http(s) URL.',
                    apiBaseCleared: 'API base reset to default.'
                },
                deck: {
                    heading: 'Deck (click to pick cards)',
                    hint: 'Click an empty slot then choose a card. Used cards grey out; use the ‚úï tag to clear a slot.'
                },
                loading: 'Crunching the hand for you...',
                result: {
                    action: 'Recommended Action',
                    confidence: 'Confidence',
                    ev: 'Expected Value'
                },
                factors: {
                    heading: 'Key Factors',
                    names: {
                        equity: 'Equity',
                        pot_odds: 'Pot Odds',
                        hand_strength: 'Hand Strength',
                        position_factor: 'Position',
                        stack_to_pot_ratio: 'SPR',
                        opponent_aggression: 'Opponent Aggression',
                        opponent_tightness: 'Opponent Tightness',
                        betting_pressure: 'Betting Pressure',
                        board_pressure: 'Board Pressure',
                        range_advantage: 'Range Advantage',
                        psychological_pressure: 'Psychological Pressure',
                        bluff_tendency: 'Bluff Tendency',
                        fold_equity: 'Fold Equity',
                        outs: 'Outs',
                        board_wetness: 'Board Texture',
                        effective_stack: 'Effective Stack',
                        draw_probability: 'Draw Probability',
                        implied_odds: 'Implied Odds',
                        pot_commitment: 'Pot Commitment'
                    }
                },
                opponentModal: {
                    title: 'Opponent Modelling',
                    apply: 'Apply Settings',
                    cancel: 'Cancel'
                },
                errors: {
                    missingCards: 'Please select two unique hole cards before running an analysis.',
                    boardRequirement: 'Please provide the correct number of community cards for the selected street.'
                },
                manual: {
                    title: 'Texas Hold\'em Game Manual',
                    basicRules: 'Basic Rules',
                    basicRulesText: 'Texas Hold\'em is a popular poker variant where each player receives 2 hole cards and combines them with 5 community cards to form the best possible 5-card hand.',
                    gameFlow: 'Game Flow',
                    preflop: 'Pre-flop',
                    preflopDesc: 'Each player receives 2 hole cards, decide to call, raise or fold based on hand strength',
                    flop: 'Flop',
                    flopDesc: 'First 3 community cards are dealt, new betting round begins',
                    turn: 'Turn',
                    turnDesc: '4th community card is dealt, continue betting',
                    river: 'River',
                    riverDesc: '5th community card is dealt, final betting round',
                    showdown: 'Showdown',
                    showdownDesc: 'Compare hand rankings, highest hand wins',
                    handRankings: 'Hand Rankings (High to Low)',
                    royalFlush: 'Royal Flush',
                    straightFlush: 'Straight Flush',
                    fourOfKind: 'Four of a Kind',
                    fullHouse: 'Full House',
                    flush: 'Flush',
                    straight: 'Straight',
                    threeOfKind: 'Three of a Kind',
                    twoPair: 'Two Pair',
                    onePair: 'One Pair',
                    highCard: 'High Card',
                    keyConcepts: 'Key Concepts',
                    potOdds: 'Pot Odds',
                    potOddsDesc: 'Ratio of current bet to pot size',
                    impliedOdds: 'Implied Odds',
                    impliedOddsDesc: 'Considering potential future winnings',
                    position: 'Position',
                    positionDesc: 'Relative to dealer button, later position has information advantage',
                    spr: 'Stack-to-Pot Ratio (SPR)',
                    sprDesc: 'Effective stack divided by pot size',
                    draws: 'Draws',
                    drawsDesc: 'Hands that need specific cards to improve',
                    positions: 'Position Guide',
                    positionsIntro: 'In Texas Hold\'em, your position relative to the dealer button determines action order and is crucial for strategy:',
                    earlyPositions: 'Early Position - Act First',
                    utg: 'UTG (Under the Gun)',
                    utgDesc: 'First to act preflop, least information, need strongest hands',
                    utg1: 'UTG+1',
                    utg1Desc: 'Second position to act, still need strong hands',
                    utg2: 'UTG+2',
                    utg2Desc: 'Can slightly widen hand requirements',
                    middlePositions: 'Middle Position',
                    mp1: 'MP1 (Middle Position 1)',
                    mp1Desc: 'Can play more marginal hands',
                    mp2: 'MP2 (Middle Position 2)',
                    mp2Desc: 'Position starts becoming favorable',
                    mp3: 'MP3 (Middle Position 3)',
                    mp3Desc: 'Approaching late position advantages',
                    latePositions: 'Late Position - Information Advantage',
                    lj: 'LJ (Lojack)',
                    ljDesc: 'Can observe early position actions before deciding',
                    hj: 'HJ (Hijack)',
                    hjDesc: 'Very favorable position, can steal blinds',
                    co: 'CO (Cutoff)',
                    coDesc: 'Second best position after button',
                    btn: 'BTN (Button)',
                    btnDesc: 'Always acts last post-flop, best position',
                    blindPositions: 'Blind Positions',
                    sb: 'SB (Small Blind)',
                    sbDesc: 'Acts first post-flop, worst position but half big blind invested',
                    bb: 'BB (Big Blind)',
                    bbDesc: 'Acts last preflop, second post-flop',
                    positionStrategy: 'Position Strategy Tips',
                    tip1: 'Early position needs stronger starting hands as many players act after you',
                    tip2: 'Late position can play more speculative hands, observe opponents first',
                    tip3: 'Button is most profitable position, can raise and steal with wider range',
                    tip4: 'Blind positions are disadvantaged post-flop but consider pot odds with investment',
                    strategies: 'Common Strategy Concepts',
                    tag: 'Tight-Aggressive (TAG)',
                    tagDesc: 'Play strong hands aggressively',
                    lag: 'Loose-Aggressive (LAG)',
                    lagDesc: 'Play more hands aggressively',
                    valueBet: 'Value Bet',
                    valueBetDesc: 'Bet strong hands for value',
                    bluff: 'Bluff',
                    bluffDesc: 'Bet weak hands to make opponents fold',
                    semiBluff: 'Semi-bluff',
                    semiBluffDesc: 'Bet drawing hands that can improve or make opponents fold',
                    startingHands: 'Starting Hands Guide',
                    startingHandsIntro: 'As a beginner, stick to these strong hands to avoid complex decisions:',
                    premiumHands: 'Premium Hands (Play from any position)',
                    strongHands: 'Strong Hands (Play from middle/late position)',
                    speculativeHands: 'Speculative Hands (Late position only)',
                    handTips: 'üí° "s" means suited, "o" means offsuit. Beginner tip: Early position = premium hands only, late position = more flexibility.'
                }
            },
            zh: {
                title: 'QPDS',
                subtitle: 'ÈáèÂåñÂæ∑Â∑ûÊâëÂÖãÂÜ≥Á≠ñËæÖÂä©Á≥ªÁªü',
                beginner: {
                    title: 'üöÄ Êñ∞ÊâãÂø´ÈÄüÂÖ•Èó®',
                    intro: 'Á¨¨‰∏ÄÊ¨°‰ΩøÁî®ÔºüÊåâ‰ª•‰∏ãÊ≠•È™§ÂºÄÂßãÔºö',
                    step1: 'ÈÄâÊã©Â∫ïÁâåÔºöÁÇπÂáªÂ∑¶Ëæπ"‰Ω†ÁöÑÂ∫ïÁâå"Âå∫ÂüüÁöÑÁ©∫ÊßΩÔºåÁÑ∂Âêé‰ªé‰∏ãÊñπÁâåÂ†ÜÈÄâÊã©‰∏§Âº†Áâå',
                    step2: 'ËÆæÁΩÆÈò∂ÊÆµÔºöÈÄâÊã©ÂΩìÂâçÊ∏∏ÊàèÈò∂ÊÆµÔºàÂª∫ËÆÆÊñ∞Êâã‰ªé"ÁøªÂâç"ÂºÄÂßãÔºâ',
                    step3: 'ËæìÂÖ•ÂèÇÊï∞ÔºöËÆæÁΩÆÂ∫ïÊ±†100„ÄÅË∑üÊ≥®20„ÄÅÂèåÊñπÁ≠πÁ†ÅÂêÑ500',
                    step4: 'ÈÄâÊã©‰ΩçÁΩÆÔºöÂ¶Ç‰∏çÁ°ÆÂÆöÈÄâÊã©"ÊåâÈíÆ‰Ωç(BTN)"',
                    step5: 'Ëé∑ÂèñÂª∫ËÆÆÔºöÁÇπÂáª"Ëé∑ÂèñÂÜ≥Á≠ñÂª∫ËÆÆ"Êü•ÁúãÊé®ËçêË°åÂä®',
                    dismiss: 'ÊàëÁü•ÈÅì‰∫Ü'
                },
                lesson: {
                    heading: 'Êó†ÈôêÊ≥®Âæ∑Â∑ûÊâëÂÖãÔºöËßÑÂàôÈÄüËßà',
                    goal: {
                        title: 'Ê†∏ÂøÉÁõÆÊ†á',
                        copy: 'ÈÄöËøáÊëäÁâåÊãø‰∏ãÊúÄÂ§ßÁâåÂäõÔºåÊàñËø´‰ΩøÊâÄÊúâÂØπÊâãÂºÉÁâåÔºåËµ¢ÂèñÂ∫ïÊ±†Á≠πÁ†Å„ÄÇ'
                    },
                    structure: {
                        title: 'ÂÆåÊï¥ÊµÅÁ®ã',
                        copy: 'ÊØè‰ΩçÁé©ÂÆ∂Ëµ∑Êâã‰∏§Âº†Â∫ïÁâåÔºåÁõ≤Ê≥®Ê≥®ÂÖ•Â∫ïÊ±†ÔºåÂÖ¨ÂÖ±Áâå‰æùÊ¨°ÁøªÁâåÂúà„ÄÅËΩ¨ÁâåÂúà„ÄÅÊ≤≥ÁâåÂúà‰∫ÆÂá∫ÔºåÊúÄÂ§öÂõõËΩÆ‰∏ãÊ≥®„ÄÇ'
                    },
                    position: {
                        title: '‰ΩçÁΩÆ‰∏é‰ø°ÊÅØ',
                        copy: 'ÊåâÈíÆ‰ΩçÁøªÁâåÂêéÊúÄÂêéË°åÂä®Ôºå‰ø°ÊÅØ‰ºòÂäøÊúÄÂ§ßÔºõÁõ≤Ê≥®‰ΩçÁΩÆÁøªÁâåÂêéÈúÄË¶Å‰ºòÂÖàË°åÂä®„ÄÇ'
                    },
                    strategy: {
                        title: 'ÈáèÂåñÊÄùÁª¥',
                        copy: 'ËÉúÁéá„ÄÅÂ∫ïÊ±†ËµîÁéá„ÄÅÈ£éÈô©ÂÅèÂ•ΩÂÖ±ÂêåÈ©±Âä®ÁêÜÊÄßÂÜ≥Á≠ñÔºå‰øùÊåÅÁ∫™ÂæãÈÅøÂÖçÊÉÖÁª™Ê≥¢Âä®„ÄÇ'
                    },
                    cheatsheet: {
                        title: 'ÁâåÊ°åÈÄüÊü•ÂÆùÂÖ∏',
                        preflop: 'ÁøªÂâçÂè£‰ª§',
                        preflop1: 'ÊåâÈíÆ‰ΩçÂºÄÂ±Ä 3 ÂÄçÁõ≤Ê≥®ÔºåÁî®ÂÆΩËåÉÂõ¥ÂÅ∑Áõ≤',
                        preflop2: 'Ââç‰ΩçÁ¥ßÂá∂Ôºö‰ªÖÈ°∂Á∫ßÂØπÂ≠ê + Âº∫ÂêåËä±ËøûÁâå',
                        preflop3: 'Â§ßÁõ≤Èò≤ÂÆàÔºöÂè™ÊúâÁâå‰ª∑ ‚â• 3:1 ÊâçËÄÉËôëË∑üÊ≥®',
                        flop: 'ÁøªÁâåËØªÁâå',
                        flop1: 'Âπ≤Áá•ÁâåÈù¢Ôºö‰∏≠Á≠âÂØπÂ≠êÂèØÊåÅÁª≠‰∏ãÊ≥®ÂéãÊ¶®Ë∂ÖÂØπ',
                        flop2: 'ÊπøÊ∂¶ÁâåÈù¢Ôºö‰ºòÂÖà‰øùÊä§ÊàêÊâãÔºåÈÄÇÂ∫¶Áº©Â∞è‰∏ãÊ≥®Â∞∫Â∫¶',
                        flop3: '‰∏≠È°∫/ÂêåËä±Âê¨ÁâåÔºöË°•ÁâåÊï∞ √ó4 ‚âà ÁøªÁâåÂêéÂëΩ‰∏≠Áéá',
                        turn: 'ËΩ¨ÁâåÂÜ≥Á≠ñ',
                        turn1: 'SPR < 1.5ÔºöÂº∫ÁâåÂèØÁõ¥Êé•Êé®Êª°ÊäïÂÖ•',
                        turn2: 'ÈÅ≠ÈÅáÂä†Ê≥®ÔºöÂà§Êñ≠ËåÉÂõ¥‰ºòÂäøÊòØÂê¶ÂèçËΩ¨',
                        turn3: 'ÂçäËØàÂî¨ÔºöÁ°Æ‰øùÂºÉÁâåÁéá √ó Â∫ïÊ±† ‚â• Êú¨ËΩÆÊàêÊú¨',
                        river: 'Ê≤≥ÁâåÊâßË°å',
                        river1: '‰ª∑ÂÄº‰∏ãÊ≥®ÔºöÁ°Æ‰øùÊõ¥Âº±ÁöÑÁâåÊÑøÊÑèË∑üÊ≥®',
                        river2: 'Á≤æÂáÜËØàÂî¨ÔºöËÆ≤Âá∫Âº∫ÁâåÊïÖ‰∫ãÂπ∂ÈòªÊñ≠ÂØπÊâãÈ°∂Áâå',
                        river3: 'ÈîôËøáÂê¨ÁâåÔºöË°°ÈáèÂºÉÁâåÁéáÂíåÊëäÁâå‰ª∑ÂÄºÂÜçÂÜ≥ÂÆö'
                    }
                },
                state: {
                    heading: 'ÁâåÂ±ÄËÆæÁΩÆ',
                    hero: '‰Ω†ÁöÑÂ∫ïÁâå',
                    board: 'ÂÖ¨ÂÖ±Áâå',
                    parameters: 'Á≠πÁ†Å‰∏éÂèÇÊï∞'
                },
                streets: {
                    PREFLOP: 'ÁøªÂâç (Preflop)',
                    FLOP: 'ÁøªÁâåÂúà (Flop)',
                    TURN: 'ËΩ¨ÁâåÂúà (Turn)',
                    RIVER: 'Ê≤≥ÁâåÂúà (River)'
                },
                fields: {
                    pot: 'Â∫ïÊ±†Â§ßÂ∞è',
                    toCall: 'ÈúÄË¶ÅË∑üÊ≥®',
                    heroStack: '‰Ω†ÁöÑÁ≠πÁ†Å',
                    villainStack: 'ÂØπÊâãÁ≠πÁ†Å',
                    numOpponents: 'Âú®Â±ÄÂØπÊâãÊï∞',
                    position: '‰Ω†ÁöÑ‰ΩçÁΩÆ',
                    villainRange: 'ÂØπÊâãËåÉÂõ¥'
                },
                summary: {
                    heading: 'ÂΩìÂâçËæìÂÖ•Ê¶ÇËßà',
                    items: {
                        pot: 'Â∫ïÊ±†Â§ßÂ∞è',
                        toCall: 'Ë∑üÊ≥®ÈáëÈ¢ù',
                        heroStack: '‰Ω†ÁöÑÁ≠πÁ†Å',
                        villainStack: 'ÂØπÊâãÁ≠πÁ†Å',
                        street: 'ÂΩìÂâçÈò∂ÊÆµ',
                        position: '‰Ω†ÁöÑ‰ΩçÁΩÆ',
                        numOpponents: 'Âú®Â±ÄÂØπÊâã',
                        risk: 'È£éÈô©ÂÅèÂ•Ω',
                        opponentModel: 'ÂØπÊâãÁîªÂÉè'
                    }
                },
                placeholders: {
                    pot: '‰æãÂ¶Ç 100',
                    toCall: '‰æãÂ¶Ç 20',
                    heroStack: '‰æãÂ¶Ç 500',
                    villainStack: '‰æãÂ¶Ç 500',
                    villainRange: 'AA,KK,QQ,AKs'
                },
                risk: {
                    conservative: '‰øùÂÆà',
                    aggressive: 'ÊøÄËøõ'
                },
                buttons: {
                    recommend: 'Ëé∑ÂèñÂÜ≥Á≠ñÂª∫ËÆÆ',
                    equity: '‰ªÖËÆ°ÁÆóËÉúÁéá',
                    reset: 'ÈáçÁΩÆÁâåÈù¢',
                    gameManual: 'üÉè Ê∏∏ÊàèÊâãÂÜå',
                    apiConfig: '‚öôÔ∏è APIÈÖçÁΩÆ',
                    opponentConfig: 'ÈÖçÁΩÆÂØπÊâãÁîªÂÉè'
                },
                opponent: {
                    heading: 'ÂØπÊâãÂª∫Ê®°',
                    calloutHint: 'Ê¢≥ÁêÜÂØπÊâãÊâìÊ≥ïÁîªÂÉèÔºåÁ≥ªÁªü‰ºöÂç≥Êó∂Âà∑Êñ∞Á≠ñÁï•Ëß£ËØª„ÄÇ',
                    aggression: {
                        label: 'ÊøÄËøõÁ®ãÂ∫¶',
                        low: 'ÂÅèË¢´Âä®',
                        high: 'Ë∂ÖÊøÄËøõ'
                    },
                    tightness: {
                        label: 'Ëµ∑ÊâãËåÉÂõ¥',
                        wide: 'ÂÆΩÊùæ',
                        narrow: 'Á¥ßÂÆû'
                    },
                    bluff: {
                        label: 'ËØàÂî¨È¢ëÁéá',
                        low: 'ÁΩïËßÅ',
                        high: 'È¢ëÁπÅ'
                    },
                    confidence: {
                        label: 'Ê°åÈù¢Ëá™‰ø°',
                        low: 'ÁäπË±´',
                        high: 'Ëá™‰ø°'
                    },
                    tilt: {
                        label: 'ÊÉÖÁª™Ê≥¢Âä®',
                        calm: 'ÂÜ∑Èùô',
                        hot: 'Êé•ËøëÂ§±Êéß'
                    },
                    bet: {
                        label: 'ÊúÄËøë‰∏ãÊ≥®Âç†Â∫ïÊ±†%',
                        placeholder: '‰æãÂ¶Ç 70'
                    },
                    action: {
                        label: 'ÊúÄËøëÂä®‰Ωú',
                        bet: '‰∏ãÊ≥®',
                        raise: 'Âä†Ê≥®',
                        call: 'Ë∑üÊ≥®',
                        check: 'ËøáÁâå',
                        amount: 'Âä®‰ΩúÈáëÈ¢ù',
                        pot: 'Ë°åÂä®ÂâçÂ∫ïÊ±†'
                    },
                    notes: {
                        label: 'È¢ùÂ§ñÂ§áÊ≥®',
                        placeholder: '‰æãÂ¶ÇÔºöÁøªÁâåÂúàÊåÅÁª≠‰∏ãÊ≥®ÔºåÊ≤≥ÁâåË∂ã‰∫éÁ¥ßÂá∂'
                    },
                    insights: {
                        heading: 'ÂØπÊâãÁîªÂÉè',
                        aggression: 'ÊøÄËøõÊåáÊï∞',
                        betting: '‰∏ãÊ≥®ÂéãÂäõ',
                        psychology: 'ÂøÉÁêÜÂéãÂº∫',
                        range: 'ËåÉÂõ¥‰ºòÂäø'
                    }
                },
                status: {
                    apiLabel: 'ÂêéÁ´Ø',
                    checking: 'Ê£ÄÊµã‰∏≠‚Ä¶',
                    connected: 'Â∑≤ËøûÊé•',
                    failed: 'Êó†Ê≥ïËøûÊé•'
                },
                analysis: {
                    stage: 'ÂΩìÂâçÈò∂ÊÆµ',
                    risk: 'È£éÈô©ÂÅèÂ•Ω',
                    cards: 'ÁâåÈù¢Ê¶ÇËßà',
                    hero: '‰Ω†ÁöÑÂ∫ïÁâå',
                    board: 'ÂÖ¨ÂÖ±Áâå',
                    explanation: 'Á≠ñÁï•Ëß£ËØª',
                    opponent: 'ÂØπÊâãÁîªÂÉè',
                    quick: {
                        cards: 'ÁâåÈù¢Ê¶ÇËßà',
                        summary: 'Êü•ÁúãËæìÂÖ•ÊÄªËßà',
                        summaryHint: 'Summary',
                        strategy: 'Á≠ñÁï•Ëß£ËØªËØ¶ÊÉÖ',
                        strategyHint: 'Playbook',
                        opponent: 'ÂØπÊâãÁîªÂÉèÊ¥ûÂØü',
                        opponentHint: 'Villain profile'
                    }
                },
                analysisModal: {
                    summaryTitle: 'ÂΩìÂâçËæìÂÖ•Ê¶ÇËßà',
                    strategyTitle: 'Á≠ñÁï•Ëß£ËØª',
                    opponentTitle: 'ÂØπÊâãÁîªÂÉèÊ¥ûÂØü'
                },
                prompts: {
                    apiBase: 'ËØ∑ËæìÂÖ•ÂêéÁ´Ø API Âú∞ÂùÄÔºà‰æãÂ¶Ç https://your-service.onrender.comÔºâ',
                    apiBaseInvalid: 'ËØ∑ËæìÂÖ•ÂêàÊ≥ïÁöÑ http(s) Âú∞ÂùÄ„ÄÇ',
                    apiBaseCleared: 'Â∑≤ÊÅ¢Â§çÈªòËÆ§Êé•Âè£Âú∞ÂùÄ„ÄÇ'
                },
                deck: {
                    heading: 'ÁâåÂ†ÜÔºàÁÇπÂáªÈÄâÁâåÔºâ',
                    hint: 'ÂÖàÁÇπÂáªÁ©∫ÊßΩÂÜçÈÄâÊã©Âç°ÁâåÔºõË¢´ÈÄâ‰∏≠ÁöÑÂç°Áâå‰ºöÁÅ∞ÊéâÔºåÁÇπÂáªÊßΩ‰ΩçÂè≥‰∏äËßíÁöÑ‚úïÂç≥ÂèØÊ∏ÖÈô§„ÄÇ'
                },
                loading: 'Ê≠£Âú®‰∏∫‰Ω†ÈáèÂåñÁâåÂ±Ä...',
                result: {
                    action: 'Êé®ËçêË°åÂä®',
                    confidence: 'ÁΩÆ‰ø°Â∫¶',
                    ev: 'ÊúüÊúõÂÄº'
                },
                factors: {
                    heading: 'ÂÖ≥ÈîÆÂõ†Â≠ê',
                    names: {
                        equity: 'ËÉúÁéá (Equity)',
                        pot_odds: 'Â∫ïÊ±†ËµîÁéá',
                        hand_strength: 'ÁâåÂäõËØÑÂàÜ',
                        position_factor: '‰ΩçÁΩÆ‰ºòÂäø',
                        stack_to_pot_ratio: 'SPR',
                        opponent_aggression: 'ÂØπÊâãÊøÄËøõÂ∫¶',
                        opponent_tightness: 'ÂØπÊâãÁ¥ßÂá∂Â∫¶',
                        betting_pressure: '‰∏ãÊ≥®ÂéãÂäõ',
                        board_pressure: 'ÁâåÈù¢ÂéãÂäõ',
                        range_advantage: 'ËåÉÂõ¥‰ºòÂäø',
                        psychological_pressure: 'ÂøÉÁêÜÂéãÂº∫',
                        bluff_tendency: 'ËØàÂî¨ÂÄæÂêë',
                        fold_equity: 'ÂºÉÁâåÁéá',
                        outs: 'Ë°•ÁâåÊï∞',
                        board_wetness: 'ÂÖ¨ÂÖ±ÁâåÂçèË∞ÉÂ∫¶',
                        effective_stack: 'ÊúâÊïàÁ≠πÁ†Å',
                        draw_probability: 'Âê¨ÁâåÂëΩ‰∏≠Áéá',
                        implied_odds: 'ÈöêÂê´ËµîÁéá',
                        pot_commitment: 'Â∫ïÊ±†ÊäïÂÖ•Â∫¶'
                    }
                },
                opponentModal: {
                    title: 'ÂØπÊâãÁîªÂÉèÈÖçÁΩÆ',
                    apply: 'Â∫îÁî®ËÆæÁΩÆ',
                    cancel: 'ÂèñÊ∂à'
                },
                errors: {
                    missingCards: 'ËØ∑ÂÖàÈÄâÊã©‰∏§Âº†ÂîØ‰∏ÄÂ∫ïÁâåÔºåÂÜçËøõË°åÂàÜÊûê„ÄÇ',
                    boardRequirement: 'ÂΩìÂâçÈò∂ÊÆµÈúÄË¶ÅÂåπÈÖçÊï∞ÈáèÁöÑÂÖ¨ÂÖ±ÁâåÔºåËØ∑Ë°•ÂÖ®ÊàñË∞ÉÊï¥Èò∂ÊÆµ„ÄÇ'
                },
                manual: {
                    title: 'Âæ∑Â∑ûÊâëÂÖãÊ∏∏ÊàèÊâãÂÜå',
                    basicRules: 'Âü∫Êú¨ËßÑÂàô',
                    basicRulesText: 'Âæ∑Â∑ûÊâëÂÖãÔºàTexas Hold\'emÔºâÊòØ‰∏ÄÁßçÊµÅË°åÁöÑÊâëÂÖãÂèò‰ΩìÔºåÊØè‰ΩçÁé©ÂÆ∂Âèë2Âº†Â∫ïÁâåÔºåÈÄöËøá‰∏é5Âº†ÂÖ¨ÂÖ±ÁâåÁªìÂêàÁªÑÊàêÊúÄ‰Ω≥ÁöÑ5Âº†ÁâåÂûã„ÄÇ',
                    gameFlow: 'Ê∏∏ÊàèÊµÅÁ®ã',
                    preflop: 'ÁøªÂâçÔºàPre-flopÔºâ',
                    preflopDesc: 'ÊØè‰ΩçÁé©ÂÆ∂Ëé∑Âæó2Âº†Â∫ïÁâåÔºåÊ†πÊçÆÁâåÂäõÂÜ≥ÂÆöË∑üÊ≥®„ÄÅÂä†Ê≥®ÊàñÂºÉÁâå',
                    flop: 'ÁøªÁâåÔºàFlopÔºâ',
                    flopDesc: 'ÂèëÂá∫Ââç3Âº†ÂÖ¨ÂÖ±ÁâåÔºåËøõË°åÊñ∞‰∏ÄËΩÆ‰∏ãÊ≥®',
                    turn: 'ËΩ¨ÁâåÔºàTurnÔºâ',
                    turnDesc: 'ÂèëÂá∫Á¨¨4Âº†ÂÖ¨ÂÖ±ÁâåÔºåÁªßÁª≠‰∏ãÊ≥®',
                    river: 'Ê≤≥ÁâåÔºàRiverÔºâ',
                    riverDesc: 'ÂèëÂá∫Á¨¨5Âº†ÂÖ¨ÂÖ±ÁâåÔºåÊúÄÂêé‰∏ÄËΩÆ‰∏ãÊ≥®',
                    showdown: 'ÊëäÁâåÔºàShowdownÔºâ',
                    showdownDesc: 'ÊØîËæÉÁâåÂûãÂ§ßÂ∞èÔºåÊúÄÂ§ßÁâåÂûãËé∑ËÉú',
                    handRankings: 'ÁâåÂûãÊéíÂêçÔºà‰ªéÂ§ßÂà∞Â∞èÔºâ',
                    royalFlush: 'ÁöáÂÆ∂ÂêåËä±È°∫',
                    straightFlush: 'ÂêåËä±È°∫',
                    fourOfKind: 'ÂõõÊù°',
                    fullHouse: 'Ëë´Ëä¶',
                    flush: 'ÂêåËä±',
                    straight: 'È°∫Â≠ê',
                    threeOfKind: '‰∏âÊù°',
                    twoPair: '‰∏§ÂØπ',
                    onePair: '‰∏ÄÂØπ',
                    highCard: 'È´òÁâå',
                    keyConcepts: 'ÂÖ≥ÈîÆÊ¶ÇÂøµ',
                    potOdds: 'Â∫ïÊ±†ËµîÁéáÔºàPot OddsÔºâ',
                    potOddsDesc: 'ÂΩìÂâçË∑üÊ≥®ÊâÄÈúÄÁ≠πÁ†Å‰∏éÂ∫ïÊ±†Â§ßÂ∞èÁöÑÊØî‰æã',
                    impliedOdds: 'ÈöêÂê´ËµîÁéáÔºàImplied OddsÔºâ',
                    impliedOddsDesc: 'ËÄÉËôëÂêéÁª≠ÂèØËÉΩËµ¢ÂæóÁ≠πÁ†ÅÁöÑËµîÁéá',
                    position: '‰ΩçÁΩÆÔºàPositionÔºâ',
                    positionDesc: 'Áõ∏ÂØπ‰∫éÂ∫ÑÂÆ∂‰ΩçÁΩÆÔºåÂêé‰ΩçÁΩÆÊúâ‰ø°ÊÅØ‰ºòÂäø',
                    spr: 'Á≠πÁ†Å-Â∫ïÊ±†ÊØîÔºàSPRÔºâ',
                    sprDesc: 'ÊúâÊïàÁ≠πÁ†ÅÈô§‰ª•Â∫ïÊ±†Â§ßÂ∞è',
                    draws: 'Âê¨ÁâåÔºàDrawÔºâ',
                    drawsDesc: 'ÈúÄË¶ÅÁâπÂÆöÁâåÊâçËÉΩÊàêÁâåÁöÑÁâåÂûã',
                    positions: '‰ΩçÁΩÆËØ¶Ëß£',
                    positionsIntro: 'Âú®Âæ∑Â∑ûÊâëÂÖã‰∏≠Ôºå‰Ω†Áõ∏ÂØπ‰∫éÂ∫ÑÂÆ∂ÊåâÈíÆÁöÑ‰ΩçÁΩÆÂÜ≥ÂÆö‰∫ÜË°åÂä®È°∫Â∫èÔºåÊòØÂΩ±ÂìçÁ≠ñÁï•ÁöÑÂÖ≥ÈîÆÂõ†Á¥†Ôºö',
                    earlyPositions: 'Ââç‰ΩçÔºàEarly PositionÔºâ- ÊúÄÂÖàË°åÂä®',
                    utg: 'UTGÔºàÊû™Âè£‰ΩçÔºâ',
                    utgDesc: 'ÁøªÂâçÁ¨¨‰∏Ä‰∏™Ë°åÂä®Ôºå‰ø°ÊÅØÊúÄÂ∞ëÔºåÈúÄË¶ÅÊúÄÂº∫ÁöÑÁâå',
                    utg1: 'UTG+1',
                    utg1Desc: 'Á¨¨‰∫å‰∏™Ë°åÂä®‰ΩçÁΩÆÔºå‰ªçÁÑ∂ÈúÄË¶ÅËæÉÂº∫ÊâãÁâå',
                    utg2: 'UTG+2',
                    utg2Desc: 'ÂèØ‰ª•Áï•ÂæÆÊîæÂÆΩÊâãÁâåË¶ÅÊ±Ç',
                    middlePositions: '‰∏≠‰ΩçÔºàMiddle PositionÔºâ',
                    mp1: 'MP1Ôºà‰∏≠Èó¥‰Ωç1Ôºâ',
                    mp1Desc: 'ÂèØ‰ª•Áé©Êõ¥Â§öËæπÈôÖÊâãÁâå',
                    mp2: 'MP2Ôºà‰∏≠Èó¥‰Ωç2Ôºâ',
                    mp2Desc: '‰ΩçÁΩÆÂºÄÂßãÂèòÂæóÊúâÂà©',
                    mp3: 'MP3Ôºà‰∏≠Èó¥‰Ωç3Ôºâ',
                    mp3Desc: 'Êé•ËøëÊôö‰ΩçÁöÑ‰ºòÂäø',
                    latePositions: 'Âêé‰ΩçÔºàLate PositionÔºâ- ‰ø°ÊÅØ‰ºòÂäø',
                    lj: 'LJÔºàÂä´Âå™‰ΩçÔºâ',
                    ljDesc: 'ÂèØ‰ª•ËßÇÂØüÂâçÈù¢Áé©ÂÆ∂Ë°åÂä®ÂêéÂÜ≥Á≠ñ',
                    hj: 'HJÔºàÂä´ÊåÅ‰ΩçÔºâ',
                    hjDesc: 'ÈùûÂ∏∏ÊúâÂà©ÁöÑ‰ΩçÁΩÆÔºåÂèØ‰ª•ÂÅ∑Áõ≤',
                    co: 'COÔºàÊà™Êñ≠‰ΩçÔºâ',
                    coDesc: '‰ªÖÊ¨°‰∫éÊåâÈíÆ‰ΩçÁöÑ‰ºòÂäø‰ΩçÁΩÆ',
                    btn: 'BTNÔºàÊåâÈíÆ‰ΩçÔºâ',
                    btnDesc: 'ÁøªÂêéÊ∞∏ËøúÊúÄÂêéË°åÂä®ÔºåÊúÄ‰Ω≥‰ΩçÁΩÆ',
                    blindPositions: 'Áõ≤Ê≥®‰ΩçÔºàBlind PositionsÔºâ',
                    sb: 'SBÔºàÂ∞èÁõ≤‰ΩçÔºâ',
                    sbDesc: 'ÁøªÂêéÁ¨¨‰∏Ä‰∏™Ë°åÂä®Ôºå‰ΩçÁΩÆÊúÄÂ∑Æ‰ΩÜÂ∑≤ÊäïÂÖ•‰∏ÄÂçäÂ§ßÁõ≤',
                    bb: 'BBÔºàÂ§ßÁõ≤‰ΩçÔºâ',
                    bbDesc: 'ÁøªÂâçÊúÄÂêéË°åÂä®ÔºåÁøªÂêéÁ¨¨‰∫å‰∏™Ë°åÂä®',
                    positionStrategy: '‰ΩçÁΩÆÁ≠ñÁï•Ë¶ÅÁÇπ',
                    tip1: 'Ââç‰ΩçÈúÄË¶ÅÊõ¥Âº∫ÁöÑËµ∑ÊâãÁâåÔºåÂõ†‰∏∫ÂêéÈù¢ËøòÊúâÂæàÂ§öÁé©ÂÆ∂Ë¶ÅË°åÂä®',
                    tip2: 'Âêé‰ΩçÂèØ‰ª•Áé©Êõ¥Â§öÊäïÊú∫ÊÄßÊâãÁâåÔºåËßÇÂØüÂØπÊâãË°åÂä®ÂêéÂÜçÂÜ≥Á≠ñ',
                    tip3: 'ÊåâÈíÆ‰ΩçÊòØÊúÄÊúâÂà©‰ΩçÁΩÆÔºåÂèØ‰ª•Áî®Êõ¥ÂÆΩÁöÑËåÉÂõ¥Âä†Ê≥®ÂíåÂÅ∑Áõ≤',
                    tip4: 'Áõ≤Ê≥®‰ΩçÁΩÆÁøªÂêé‰∏çÂà©Ôºå‰ΩÜÁøªÂâçÂ∑≤ÊúâÊäïÂÖ•Ë¶ÅËÄÉËôëÂ∫ïÊ±†ËµîÁéá',
                    strategies: 'Â∏∏Áî®Á≠ñÁï•Ê¶ÇÂøµ',
                    tag: 'Á¥ßÂá∂ÔºàTAGÔºâ',
                    tagDesc: 'Âè™Áé©Âº∫Áâå‰ΩÜÁé©ÂæóÊøÄËøõ',
                    lag: 'ÊùæÂá∂ÔºàLAGÔºâ',
                    lagDesc: 'Áé©ËæÉÂ§öÁâåÂûã‰∏îÊøÄËøõ‰∏ãÊ≥®',
                    valueBet: '‰ª∑ÂÄº‰∏ãÊ≥®',
                    valueBetDesc: 'ÊúâÂº∫ÁâåÊó∂‰∏ãÊ≥®Ëé∑Âèñ‰ª∑ÂÄº',
                    bluff: 'ËØàÂî¨ÔºàBluffÔºâ',
                    bluffDesc: 'Áî®Âº±Áâå‰∏ãÊ≥®Ëø´‰ΩøÂØπÊâãÂºÉÁâå',
                    semiBluff: 'ÂçäËØàÂî¨',
                    semiBluffDesc: 'Áî®Âê¨Áâå‰∏ãÊ≥®ÔºåÊó¢ÂèØËÉΩÊàêÁâå‰πüÂèØËÉΩËÆ©ÂØπÊâãÂºÉÁâå',
                    startingHands: 'Êñ∞ÊâãËµ∑ÊâãÁâåÂª∫ËÆÆ',
                    startingHandsIntro: '‰Ωú‰∏∫Êñ∞ÊâãÔºåÂª∫ËÆÆÂè™Áé©‰ª•‰∏ãÂº∫ÁâåÔºåÈÅøÂÖçÂ§çÊùÇÂÜ≥Á≠ñÔºö',
                    premiumHands: 'È°∂Á∫ßÂº∫ÁâåÔºà‰ªª‰Ωï‰ΩçÁΩÆÈÉΩÂèØ‰ª•Áé©Ôºâ',
                    strongHands: 'Âº∫ÁâåÔºà‰∏≠Âêé‰ΩçÂèØ‰ª•Áé©Ôºâ',
                    speculativeHands: 'ÊäïÊú∫ÁâåÔºà‰ªÖÂêé‰ΩçËÄÉËôëÔºâ',
                    handTips: 'üí° "s"Ë°®Á§∫ÂêåËä±Ëâ≤Ôºå"o"Ë°®Á§∫‰∏çÂêåËä±Ëâ≤„ÄÇÊñ∞ÊâãÂª∫ËÆÆÔºöÂâç‰ΩçÂè™Áé©È°∂Á∫ßÂº∫ÁâåÔºåÂêé‰ΩçÂèØ‰ª•ÈÄÇÂΩìÊîæÂÆΩ„ÄÇ'
                }
            }
        };

        const positionLabels = {
            BTN: { en: 'Button (BTN)', zh: 'ÊåâÈíÆ‰Ωç (BTN)' },
            CO: { en: 'Cutoff (CO)', zh: 'Êà™Êñ≠‰Ωç (CO)' },
            HJ: { en: 'Hijack (HJ)', zh: 'Âä´ÊåÅ‰Ωç (HJ)' },
            LJ: { en: 'Lojack (LJ)', zh: 'Âä´Âå™‰Ωç (LJ)' },
            MP3: { en: 'Middle Position 3', zh: '‰∏≠Èó¥‰Ωç3' },
            MP2: { en: 'Middle Position 2', zh: '‰∏≠Èó¥‰Ωç2' },
            MP1: { en: 'Middle Position 1', zh: '‰∏≠Èó¥‰Ωç1' },
            UTG2: { en: 'UTG +2', zh: 'Êû™Âè£+2' },
            UTG1: { en: 'UTG +1', zh: 'Êû™Âè£+1' },
            UTG: { en: 'Under the Gun (UTG)', zh: 'Êû™Âè£‰Ωç (UTG)' },
            SB: { en: 'Small Blind (SB)', zh: 'Â∞èÁõ≤‰Ωç (SB)' },
            BB: { en: 'Big Blind (BB)', zh: 'Â§ßÁõ≤‰Ωç (BB)' }
        };

        const streetBoardCounts = {
            PREFLOP: 0,
            FLOP: 3,
            TURN: 4,
            RIVER: 5
        };

        const actionLabels = {
            en: {
                fold: 'Fold',
                check: 'Check',
                call: 'Call',
                raise: 'Raise',
                all_in: 'All-in'
            },
            zh: {
                fold: 'ÂºÉÁâå',
                check: 'ËøáÁâå',
                call: 'Ë∑üÊ≥®',
                raise: 'Âä†Ê≥®',
                all_in: 'ÂÖ®‰∏ã'
            }
        };

        const suits = [
            { key: 'spades', symbol: '‚ô†', code: 's' },
            { key: 'hearts', symbol: '‚ô•', code: 'h' },
            { key: 'diamonds', symbol: '‚ô¶', code: 'd' },
            { key: 'clubs', symbol: '‚ô£', code: 'c' }
        ];

        const ranks = ['2', '3', '4', '5', '6', '7', '8', '9', 'T', 'J', 'Q', 'K', 'A'];

        const percentFactorKeys = new Set([
            'equity',
            'pot_odds',
            'hand_strength',
            'position_factor',
            'fold_equity',
            'board_wetness',
            'betting_pressure',
            'board_pressure',
            'range_advantage',
            'psychological_pressure',
            'bluff_tendency',
            'opponent_aggression',
            'opponent_tightness',
            'draw_probability',
            'implied_odds',
            'pot_commitment'
        ]);

        const state = {
            language: 'zh',
            heroCards: [null, null],
            board: [null, null, null, null, null],
            street: 'PREFLOP',
            selectedSlot: null,
            position: 'BTN',
            numOpponents: 1,
            lastResult: null,
            apiStatus: 'idle',
            opponent: {
                aggression: 0.6,
                tightness: 0.5,
                bluff: 0.3,
                confidence: 0.6,
                tilt: 0.4,
                betPct: 65,
                action: {
                    street: 'PREFLOP',
                    type: 'bet',
                    amount: null,
                    pot: null
                },
                notes: ''
            },
            opponentProfile: null
        };

        window.addEventListener('DOMContentLoaded', () => {
            deckGrid = document.getElementById('deckGrid');
            heroSlots = document.getElementById('heroSlots');
            boardSlots = document.getElementById('boardSlots');
            streetOptions = document.getElementById('streetOptions');
            positionSelect = document.getElementById('positionSelect');
            riskSlider = document.getElementById('riskSlider');
            riskValue = document.getElementById('riskValue');
            langToggle = document.getElementById('langToggle');
            apiConfigBtn = document.getElementById('apiConfigBtn');
            apiStatusLabel = document.getElementById('apiStatusLabel');
            loadingIndicator = document.getElementById('loading');
            actionValue = document.getElementById('actionValue');
            confidenceValue = document.getElementById('confidenceValue');
            evValue = document.getElementById('evValue');
            resultBanner = document.getElementById('resultBanner');
            explanationBox = document.getElementById('explanationBox');
            factorsGrid = document.getElementById('factorsGrid');
            errorBox = document.getElementById('errorBox');
            summaryGrid = document.getElementById('summaryGrid');
            numOpponentsInput = document.getElementById('numOpponentsInput');
            opponentInsightsPanel = document.getElementById('opponentInsights');
            opponentArchetype = document.getElementById('opponentArchetype');
            opponentSummary = document.getElementById('opponentSummary');
            opponentNotesContainer = document.getElementById('opponentNotes');
            opponentAggressionMetric = document.getElementById('opponentAggressionMetric');
            opponentBettingMetric = document.getElementById('opponentBettingMetric');
            opponentPsychologyMetric = document.getElementById('opponentPsychologyMetric');
            opponentRangeMetric = document.getElementById('opponentRangeMetric');
            stageValueEl = document.getElementById('stageValue');
            riskMetricValueEl = document.getElementById('riskMetricValue');
            analysisHeroCards = document.getElementById('analysisHeroCards');
            analysisBoardCards = document.getElementById('analysisBoardCards');
            analysisSummaryModal = document.getElementById('analysisSummaryModal');
            analysisStrategyModal = document.getElementById('analysisStrategyModal');
            analysisOpponentModal = document.getElementById('analysisOpponentModal');
            closeAnalysisSummaryBtn = document.getElementById('closeAnalysisSummary');
            closeAnalysisStrategyBtn = document.getElementById('closeAnalysisStrategy');
            closeAnalysisOpponentBtn = document.getElementById('closeAnalysisOpponent');
            analysisSummaryBtn = document.getElementById('analysisSummaryBtn');
            analysisStrategyBtn = document.getElementById('analysisStrategyBtn');
            analysisOpponentBtn = document.getElementById('analysisOpponentBtn');
            opponentModal = document.getElementById('opponentModal');
            opponentModalBtn = document.getElementById('opponentModalBtn');
            opponentModalClose = document.getElementById('closeOpponentModal');
            opponentModalCancel = document.getElementById('opponentModalCancel');
            opponentModalSave = document.getElementById('opponentModalSave');
            opAggressionInput = document.getElementById('opAggressionInput');
            opTightnessInput = document.getElementById('opTightnessInput');
            opBluffInput = document.getElementById('opBluffInput');
            opConfidenceInput = document.getElementById('opConfidenceInput');
            opTiltInput = document.getElementById('opTiltInput');
            opBetPctInput = document.getElementById('opBetPctInput');
            opActionStreet = document.getElementById('opActionStreet');
            opActionType = document.getElementById('opActionType');
            opActionAmount = document.getElementById('opActionAmount');
            opActionPot = document.getElementById('opActionPot');
            opNotesInput = document.getElementById('opNotesInput');
            opAggressionValue = document.getElementById('opAggressionValue');
            opTightnessValue = document.getElementById('opTightnessValue');
            opBluffValue = document.getElementById('opBluffValue');
            opConfidenceValue = document.getElementById('opConfidenceValue');
            opTiltValue = document.getElementById('opTiltValue');

            // Ê∏∏ÊàèÊâãÂÜåÁõ∏ÂÖ≥ÂÖÉÁ¥†
            const gameManualBtn = document.getElementById('gameManualBtn');
            const gameManualModal = document.getElementById('gameManualModal');
            const closeManualBtn = document.getElementById('closeManualBtn');

            // Êñ∞ÊâãÊèêÁ§∫Áõ∏ÂÖ≥ÂÖÉÁ¥†
            const beginnerTip = document.getElementById('beginnerTip');
            const dismissTip = document.getElementById('dismissTip');

            // Ê£ÄÊü•ÊòØÂê¶ÊòØÁ¨¨‰∏ÄÊ¨°ËÆøÈóÆ
            const hasVisited = localStorage.getItem('qpds_visited');
            if (hasVisited) {
                beginnerTip.classList.add('hidden');
            }

            // Êñ∞ÊâãÊèêÁ§∫ÂÖ≥Èó≠‰∫ã‰ª∂
            dismissTip.addEventListener('click', () => {
                beginnerTip.classList.add('hidden');
                localStorage.setItem('qpds_visited', 'true');
            });

            const closeAnalysisSummary = () => {
                if (analysisSummaryModal) {
                    analysisSummaryModal.classList.remove('show');
                }
            };

            const closeAnalysisStrategy = () => {
                if (analysisStrategyModal) {
                    analysisStrategyModal.classList.remove('show');
                }
            };

            const closeAnalysisOpponent = () => {
                if (analysisOpponentModal) {
                    analysisOpponentModal.classList.remove('show');
                }
            };

            // Ê∏∏ÊàèÊâãÂÜå‰∫ã‰ª∂ÁõëÂê¨
            gameManualBtn.addEventListener('click', () => {
                gameManualModal.classList.add('show');
            });

            closeManualBtn.addEventListener('click', () => {
                gameManualModal.classList.remove('show');
            });

            // ÁÇπÂáªÊ®°ÊÄÅÊ°ÜËÉåÊôØÂÖ≥Èó≠
            gameManualModal.addEventListener('click', (e) => {
                if (e.target === gameManualModal) {
                    gameManualModal.classList.remove('show');
                }
            });

            if (analysisSummaryBtn && analysisSummaryModal) {
                analysisSummaryBtn.addEventListener('click', () => {
                    analysisSummaryModal.classList.add('show');
                });
            }

            if (closeAnalysisSummaryBtn) {
                closeAnalysisSummaryBtn.addEventListener('click', closeAnalysisSummary);
            }

            if (analysisSummaryModal) {
                analysisSummaryModal.addEventListener('click', (event) => {
                    if (event.target === analysisSummaryModal) {
                        closeAnalysisSummary();
                    }
                });
            }

            if (analysisStrategyBtn && analysisStrategyModal) {
                analysisStrategyBtn.addEventListener('click', () => {
                    analysisStrategyModal.classList.add('show');
                });
            }

            if (closeAnalysisStrategyBtn) {
                closeAnalysisStrategyBtn.addEventListener('click', closeAnalysisStrategy);
            }

            if (analysisStrategyModal) {
                analysisStrategyModal.addEventListener('click', (event) => {
                    if (event.target === analysisStrategyModal) {
                        closeAnalysisStrategy();
                    }
                });
            }

            if (analysisOpponentBtn && analysisOpponentModal) {
                analysisOpponentBtn.addEventListener('click', () => {
                    analysisOpponentModal.classList.add('show');
                });
            }

            if (closeAnalysisOpponentBtn) {
                closeAnalysisOpponentBtn.addEventListener('click', closeAnalysisOpponent);
            }

            if (analysisOpponentModal) {
                analysisOpponentModal.addEventListener('click', (event) => {
                    if (event.target === analysisOpponentModal) {
                        closeAnalysisOpponent();
                    }
                });
            }

            // ESCÈîÆÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü
            document.addEventListener('keydown', (e) => {
                if (e.key !== 'Escape') {
                    return;
                }

                if (gameManualModal.classList.contains('show')) {
                    gameManualModal.classList.remove('show');
                }

                if (analysisSummaryModal && analysisSummaryModal.classList.contains('show')) {
                    closeAnalysisSummary();
                }

                if (analysisStrategyModal && analysisStrategyModal.classList.contains('show')) {
                    closeAnalysisStrategy();
                }

                if (analysisOpponentModal && analysisOpponentModal.classList.contains('show')) {
                    closeAnalysisOpponent();
                }

                if (opponentModal && opponentModal.classList.contains('show')) {
                    opponentModal.classList.remove('show');
                    opponentDraft = null;
                }
            });

            if (opponentModalBtn && opponentModal) {
                opponentModalBtn.addEventListener('click', () => {
                    opponentDraft = cloneOpponentState(state.opponent);
                    syncOpponentControls();
                    opponentModal.classList.add('show');
                });
            }

            const closeOpponentModal = () => {
                if (opponentModal) {
                    opponentModal.classList.remove('show');
                }
                opponentDraft = null;
            };

            if (opponentModalClose) {
                opponentModalClose.addEventListener('click', closeOpponentModal);
            }

            if (opponentModalCancel) {
                opponentModalCancel.addEventListener('click', closeOpponentModal);
            }

            if (opponentModal) {
                opponentModal.addEventListener('click', (event) => {
                    if (event.target === opponentModal) {
                        closeOpponentModal();
                    }
                });
            }

            if (opponentModalSave) {
                opponentModalSave.addEventListener('click', () => {
                    if (opponentDraft) {
                        state.opponent = cloneOpponentState(opponentDraft);
                        refreshSummary();
                    }
                    closeOpponentModal();
                });
            }

            bootstrap();
        });

        function t(key) {
            const parts = key.split('.');
            let cursor = translations[state.language];
            for (const part of parts) {
                if (cursor && part in cursor) {
                    cursor = cursor[part];
                } else {
                    return key;
                }
            }
            return cursor;
        }

        function translatePage() {
            document.documentElement.lang = state.language;
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                const text = t(key);
                if (typeof text === 'string') {
                    el.textContent = text;
                }
            });

            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                const text = t(key);
                if (typeof text === 'string') {
                    el.setAttribute('placeholder', text);
                }
            });

            // Re-translate stage labels
            streetOptions.querySelectorAll('label').forEach(label => {
                const street = label.getAttribute('data-street');
                const span = label.querySelector('span');
                if (span) {
                    span.textContent = t(`streets.${street}`);
                }
            });

            // Rebuild position select options
            const selected = positionSelect.value;
            positionSelect.innerHTML = '';
            Object.entries(positionLabels).forEach(([value, labels]) => {
                const option = document.createElement('option');
                option.value = value;
                option.textContent = labels[state.language];
                if (value === selected) {
                    option.selected = true;
                }
                positionSelect.appendChild(option);
            });

            langToggle.textContent = state.language === 'en' ? '‰∏≠Êñá' : 'English';

            refreshSummary();

            if (state.lastResult) {
                const snapshot = state.lastResult;
                if (snapshot.kind === 'recommendation') {
                    showRecommendation(snapshot.data);
                } else if (snapshot.kind === 'equity') {
                    showEquityOnly(snapshot.data);
                }
            }

            updateApiStatusLabel();
        }

        function getStatusCopy() {
            const fallback = {
                apiLabel: 'API',
                checking: 'checking‚Ä¶',
                connected: 'online',
                failed: 'unreachable'
            };
            return (translations[state.language] && translations[state.language].status) || fallback;
        }

        function updateApiStatusLabel(statusOverride) {
            if (!apiStatusLabel) {
                return;
            }
            const copy = getStatusCopy();
            const status = statusOverride || state.apiStatus;
            let suffix = '';
            if (status === 'checking') {
                suffix = copy.checking;
            } else if (status === 'ok') {
                suffix = copy.connected;
            } else if (status === 'error') {
                suffix = copy.failed;
            }

            const parts = [`${copy.apiLabel}: ${API_URL}`];
            if (suffix) {
                parts.push(`(${suffix})`);
            }
            apiStatusLabel.textContent = parts.join(' ');
        }

        function getBackendUnavailableMessage() {
            if (state.language === 'zh') {
                return `Êó†Ê≥ïËøûÊé•ÂêéÁ´ØÊúçÂä°Ôºö${API_URL}„ÄÇËØ∑ÂêØÂä®Êú¨Âú∞ Flask ÂêéÁ´ØÔºåÊàñÁÇπÂáª‚Äú‚öôÔ∏è APIÈÖçÁΩÆ‚ÄùÊåâÈíÆËÆæÁΩÆÂ∑≤ÈÉ®ÁΩ≤ÁöÑÂú∞ÂùÄ„ÄÇ`;
            }
            return `Cannot reach backend service at ${API_URL}. Start the local Flask backend or use the ‚öôÔ∏è API button to point to your deployed service.`;
        }

        function initApiConfig() {
            if (!apiConfigBtn) {
                return;
            }
            apiConfigBtn.addEventListener('click', () => {
                const promptMessage = t('prompts.apiBase');
                const input = window.prompt(promptMessage, API_URL);
                if (input === null) {
                    return;
                }

                const trimmed = input.trim();
                if (!trimmed) {
                    localStorage.removeItem(API_STORAGE_KEY);
                    API_URL = resolveApiUrl({ skipQuery: true });
                    state.apiStatus = 'idle';
                    updateApiStatusLabel();
                    window.alert(t('prompts.apiBaseCleared'));
                    initHealthCheck({ silent: true });
                    return;
                }

                const sanitized = sanitizeApiUrl(trimmed);
                if (!sanitized) {
                    window.alert(t('prompts.apiBaseInvalid'));
                    return;
                }

                API_URL = sanitized;
                localStorage.setItem(API_STORAGE_KEY, API_URL);
                state.apiStatus = 'checking';
                updateApiStatusLabel('checking');
                initHealthCheck();
            });

            updateApiStatusLabel();
        }

        function buildDeck() {
            deckGrid.innerHTML = '';
            suits.forEach(suit => {
                const row = document.createElement('div');
                row.className = 'deck-row';
                row.dataset.suit = suit.key;

                const label = document.createElement('div');
                label.className = 'deck-suit';
                label.textContent = suit.symbol;
                row.appendChild(label);
                ranks.forEach(rank => {
                    const cardCode = `${rank}${suit.code}`;
                    const button = document.createElement('button');
                    button.className = 'card-button';
                    button.dataset.card = `${rank}${suit.code}`;
                    button.dataset.suit = suit.key;
                    button.innerHTML = `${rank}${suit.symbol}`;
                    button.addEventListener('click', () => onDeckCardSelected(cardCode));
                    row.appendChild(button);
                });
                deckGrid.appendChild(row);
            });
            updateDeckAvailability();
        }

        function createSlotElement(type, index, cardCode) {
            const slot = document.createElement('div');
            slot.className = 'card-slot';
            slot.dataset.type = type;
            slot.dataset.index = index;
            const disabled = type === 'board' && index >= streetBoardCounts[state.street];
            slot.dataset.disabled = disabled ? 'true' : 'false';
            if (disabled) {
                return slot;
            }

            const label = document.createElement('span');
            label.className = 'card-label';
            label.textContent = type === 'hero' ? `P${index + 1}` : `B${index + 1}`;
            slot.appendChild(label);

            if (cardCode) {
                slot.dataset.filled = 'true';
                slot.textContent = cardCode.toUpperCase();
                slot.appendChild(label);

                const tag = document.createElement('div');
                tag.className = 'remove-tag';
                tag.textContent = '‚úï';
                tag.addEventListener('click', (event) => {
                    event.stopPropagation();
                    clearSlot(type, index);
                });
                slot.appendChild(tag);
            } else {
                slot.dataset.filled = 'false';
                slot.appendChild(label);
            }

            if (state.selectedSlot && state.selectedSlot.type === type && state.selectedSlot.index === index) {
                slot.dataset.selected = 'true';
            }

            slot.addEventListener('click', () => onSlotClick(type, index));
            return slot;
        }

        function renderSlots() {
            heroSlots.innerHTML = '';
            state.heroCards.forEach((card, index) => {
                heroSlots.appendChild(createSlotElement('hero', index, card));
            });

            boardSlots.innerHTML = '';
            state.board.forEach((card, index) => {
                boardSlots.appendChild(createSlotElement('board', index, card));
            });

            refreshSummary();
        }

        function onSlotClick(type, index) {
            const disabled = type === 'board' && index >= streetBoardCounts[state.street];
            if (disabled) {
                return;
            }

            const currentCard = type === 'hero' ? state.heroCards[index] : state.board[index];
            if (currentCard) {
                clearSlot(type, index);
                return;
            }

            state.selectedSlot = { type, index };
            renderSlots();
        }

        function clearSlot(type, index) {
            if (type === 'hero') {
                state.heroCards[index] = null;
            } else {
                state.board[index] = null;
            }
            if (state.selectedSlot && state.selectedSlot.type === type && state.selectedSlot.index === index) {
                state.selectedSlot = null;
            }
            updateDeckAvailability();
            renderSlots();
        }

        function isCardUsed(cardCode) {
            const allCards = [...state.heroCards, ...state.board];
            return allCards.includes(cardCode.toLowerCase());
        }

        function findNextAvailableSlot() {
            for (let i = 0; i < state.heroCards.length; i += 1) {
                if (!state.heroCards[i]) {
                    return { type: 'hero', index: i };
                }
            }
            const allowedBoard = streetBoardCounts[state.street];
            for (let i = 0; i < allowedBoard; i += 1) {
                if (!state.board[i]) {
                    return { type: 'board', index: i };
                }
            }
            return null;
        }

        function onDeckCardSelected(cardCode) {
            if (isCardUsed(cardCode)) {
                return;
            }

            let targetSlot = state.selectedSlot;
            if (!targetSlot) {
                targetSlot = findNextAvailableSlot();
            }
            if (!targetSlot) {
                return;
            }

            if (targetSlot.type === 'hero') {
                state.heroCards[targetSlot.index] = cardCode.toLowerCase();
            } else {
                state.board[targetSlot.index] = cardCode.toLowerCase();
            }

            state.selectedSlot = findNextAvailableSlot();
            updateDeckAvailability();
            renderSlots();
        }

        function updateDeckAvailability() {
            const used = new Set([...state.heroCards, ...state.board].filter(Boolean));
            deckGrid.querySelectorAll('.card-button').forEach(button => {
                const code = (button.dataset.card || '').toLowerCase();
                button.dataset.used = used.has(code) ? 'true' : 'false';
            });
        }

        function onStreetChange(value) {
            state.street = value;
            // Trim board cards beyond allowed count
            const allowed = streetBoardCounts[value];
            state.board = state.board.map((card, index) => (index < allowed ? card : null));
            if (state.selectedSlot && state.selectedSlot.type === 'board' && state.selectedSlot.index >= allowed) {
                state.selectedSlot = null;
            }
            renderSlots();
        }

        function resetBoardSelections() {
            state.heroCards = [null, null];
            state.board = [null, null, null, null, null];
            state.street = 'PREFLOP';
            state.selectedSlot = null;
            streetOptions.querySelectorAll('label').forEach(label => {
                label.classList.toggle('active', label.getAttribute('data-street') === 'PREFLOP');
                label.querySelector('input').checked = label.getAttribute('data-street') === 'PREFLOP';
            });
            renderSlots();
            updateDeckAvailability();
            clearResult();
            showError('');
            state.opponent = {
                aggression: 0.6,
                tightness: 0.5,
                bluff: 0.3,
                confidence: 0.6,
                tilt: 0.4,
                betPct: 65,
                action: {
                    street: 'PREFLOP',
                    type: 'bet',
                    amount: null,
                    pot: null
                },
                notes: ''
            };
            if (opAggressionInput) {
                opAggressionInput.value = 6;
                opAggressionInput.dispatchEvent(new Event('input'));
            }
            if (opTightnessInput) {
                opTightnessInput.value = 5;
                opTightnessInput.dispatchEvent(new Event('input'));
            }
            if (opBluffInput) {
                opBluffInput.value = 3;
                opBluffInput.dispatchEvent(new Event('input'));
            }
            if (opConfidenceInput) {
                opConfidenceInput.value = 6;
                opConfidenceInput.dispatchEvent(new Event('input'));
            }
            if (opTiltInput) {
                opTiltInput.value = 4;
                opTiltInput.dispatchEvent(new Event('input'));
            }
            if (opBetPctInput) {
                opBetPctInput.value = 65;
                opBetPctInput.dispatchEvent(new Event('input'));
            }
            if (opActionStreet) {
                opActionStreet.value = 'PREFLOP';
                opActionStreet.dispatchEvent(new Event('change'));
            }
            if (opActionType) {
                opActionType.value = 'bet';
                opActionType.dispatchEvent(new Event('change'));
            }
            if (opActionAmount) {
                opActionAmount.value = '';
                opActionAmount.dispatchEvent(new Event('input'));
            }
            if (opActionPot) {
                opActionPot.value = '';
                opActionPot.dispatchEvent(new Event('input'));
            }
            if (opNotesInput) {
                opNotesInput.value = '';
                state.opponent.notes = '';
            }
            refreshSummary();
        }

        function buildOpponentObservationPayload() {
            const { action } = state.opponent;
            if (!action || !action.street || !action.type) {
                return null;
            }
            const payload = {
                street: action.street,
                action: action.type
            };
            if (Number.isFinite(action.amount) && Number.isFinite(action.pot) && action.pot > 0) {
                payload.amount = action.amount;
                payload.pot = action.pot;
            }
            return payload;
        }

        function getOpponentStatsPayload() {
            const stats = {
                aggression: state.opponent.aggression,
                tightness: state.opponent.tightness,
                bluff_frequency: state.opponent.bluff,
                recent_bet_pct: state.opponent.betPct,
                confidence: state.opponent.confidence,
                tilt: state.opponent.tilt
            };

            const observation = buildOpponentObservationPayload();
            if (observation) {
                stats.observations = [observation];
            }

            if (state.opponent.notes && state.opponent.notes.trim()) {
                stats.notes = state.opponent.notes.trim();
            }

            return stats;
        }

        function buildOpponentPreviousActions() {
            const observation = buildOpponentObservationPayload();
            if (!observation || observation.amount === undefined) {
                return null;
            }
            return [{
                actor: 'villain',
                street: observation.street,
                action: observation.action,
                amount: observation.amount,
                pot: observation.pot
            }];
        }

        function gatherGameState() {
            const opponentStats = getOpponentStatsPayload();
            const previousActions = buildOpponentPreviousActions();

            const payload = {
                hero_cards: state.heroCards.filter(Boolean).map(card => card.toUpperCase()),
                board: state.board.filter((card, index) => index < streetBoardCounts[state.street] && card).map(card => card.toUpperCase()),
                pot_size: parseFloat(document.getElementById('potInput').value) || 0,
                to_call: parseFloat(document.getElementById('toCallInput').value) || 0,
                hero_stack: parseFloat(document.getElementById('heroStackInput').value) || 0,
                villain_stack: parseFloat(document.getElementById('villainStackInput').value) || 0,
                position: positionSelect.value,
                street: state.street,
                villain_range: document.getElementById('rangeInput').value || null,
                risk_preference: parseFloat(riskSlider.value) || 5,
                num_opponents: state.numOpponents,
                opponent_stats: opponentStats
            };

            if (previousActions) {
                payload.previous_actions = previousActions;
            }

            return payload;
        }

        function showLoading() {
            loadingIndicator.classList.add('active');
            resultBanner.style.display = 'none';
            explanationBox.style.display = 'none';
            factorsGrid.innerHTML = '';
        }

        function hideLoading() {
            loadingIndicator.classList.remove('active');
        }

        function clearResult() {
            resultBanner.style.display = 'none';
            explanationBox.style.display = 'none';
            factorsGrid.innerHTML = '';
            confidenceValue.textContent = '-';
            evValue.textContent = '-';
            state.lastResult = null;
            if (opponentInsightsPanel) {
                opponentInsightsPanel.style.display = 'none';
                if (opponentArchetype) opponentArchetype.textContent = '';
                if (opponentSummary) opponentSummary.textContent = '';
                if (opponentAggressionMetric) opponentAggressionMetric.textContent = '-';
                if (opponentBettingMetric) opponentBettingMetric.textContent = '-';
                if (opponentPsychologyMetric) opponentPsychologyMetric.textContent = '-';
                if (opponentRangeMetric) opponentRangeMetric.textContent = '-';
                if (opponentNotesContainer) opponentNotesContainer.innerHTML = '';
            }
            state.opponentProfile = null;
        }

        function formatPercent(value, digits = 1) {
            if (typeof value !== 'number' || Number.isNaN(value)) {
                return '-';
            }
            return `${(value * 100).toFixed(digits)}%`;
        }

        function formatFactorValue(key, value) {
            if (value === null || value === undefined) {
                return '-';
            }
            if (percentFactorKeys.has(key)) {
                return formatPercent(value);
            }
            if (key === 'outs') {
                return `${Math.round(value)}`;
            }
            return `${Number(value).toFixed(2)}`;
        }

        function displayFactors(factors) {
            if (!factors) {
                return;
            }
            const keys = [
                'equity',
                'hand_strength',
                'range_advantage',
                'opponent_aggression',
                'opponent_tightness',
                'betting_pressure',
                'board_wetness',
                'board_pressure',
                'psychological_pressure',
                'fold_equity',
                'bluff_tendency',
                'pot_odds',
                'position_factor',
                'stack_to_pot_ratio',
                'effective_stack',
                'implied_odds',
                'pot_commitment',
                'outs',
                'draw_probability'
            ];
            factorsGrid.innerHTML = '';
            keys.forEach(key => {
                if (factors[key] === undefined) {
                    return;
                }
                const card = document.createElement('div');
                card.className = 'factor-card';

                const name = document.createElement('div');
                name.className = 'factor-name';
                const factorName = translations[state.language].factors.names[key] || key;
                name.textContent = factorName;

                const value = document.createElement('div');
                value.className = 'factor-value';
                value.textContent = formatFactorValue(key, factors[key]);

                card.appendChild(name);
                card.appendChild(value);
                factorsGrid.appendChild(card);
            });
        }

        function renderOpponentInsights(profile, factors) {
            if (!opponentInsightsPanel) {
                return;
            }

            let resolved = profile;
            if (!resolved && factors) {
                resolved = {
                    classification: factors.opponent_classification,
                    summary: factors.opponent_summary,
                    notes: factors.opponent_notes,
                    aggression_index: factors.opponent_aggression,
                    betting_pressure: factors.betting_pressure,
                    psychological_pressure: factors.psychological_pressure,
                    range_advantage: factors.range_advantage
                };
            }

            if (!resolved || (!resolved.classification && !resolved.summary)) {
                opponentInsightsPanel.style.display = 'none';
                state.opponentProfile = null;
                return;
            }

            state.opponentProfile = resolved;
            opponentInsightsPanel.style.display = 'block';

            if (opponentArchetype) {
                opponentArchetype.textContent = resolved.classification || '';
            }
            if (opponentSummary) {
                opponentSummary.textContent = resolved.summary || '';
            }
            if (opponentAggressionMetric) {
                opponentAggressionMetric.textContent = formatPercent(resolved.aggression_index ?? factors?.opponent_aggression ?? 0, 1);
            }
            if (opponentBettingMetric) {
                opponentBettingMetric.textContent = formatPercent(resolved.betting_pressure ?? factors?.betting_pressure ?? 0, 1);
            }
            if (opponentPsychologyMetric) {
                opponentPsychologyMetric.textContent = formatPercent(resolved.psychological_pressure ?? factors?.psychological_pressure ?? 0, 1);
            }
            if (opponentRangeMetric) {
                opponentRangeMetric.textContent = formatPercent(resolved.range_advantage ?? factors?.range_advantage ?? 0, 1);
            }

            if (opponentNotesContainer) {
                opponentNotesContainer.innerHTML = '';
                const notes = [];
                if (Array.isArray(resolved.notes)) {
                    notes.push(...resolved.notes);
                } else if (resolved.notes) {
                    notes.push(resolved.notes);
                }
                if (factors?.opponent_notes && Array.isArray(factors.opponent_notes)) {
                    notes.push(...factors.opponent_notes);
                }

                if (notes.length === 0) {
                    const empty = document.createElement('div');
                    empty.className = 'insight-note';
                    empty.textContent = state.language === 'zh' ? 'ÊöÇÊó†Êõ¥Â§öÁ∫øÁ¥¢Ôºå‰øùÊåÅËßÇÂØü„ÄÇ' : 'No additional reads yet ‚Äî keep observing.';
                    opponentNotesContainer.appendChild(empty);
                } else {
                    notes.slice(0, 4).forEach(note => {
                        const item = document.createElement('div');
                        item.className = 'insight-note';
                        item.textContent = note;
                        opponentNotesContainer.appendChild(item);
                    });
                }
            }
        }

        function getNumericValue(id) {
            const el = document.getElementById(id);
            if (!el) {
                return 0;
            }
            return parseFloat(el.value) || 0;
        }

        function cloneOpponentState(source) {
            return {
                aggression: source.aggression ?? 0.6,
                tightness: source.tightness ?? 0.5,
                bluff: source.bluff ?? 0.3,
                confidence: source.confidence ?? 0.6,
                tilt: source.tilt ?? 0.4,
                betPct: source.betPct ?? 65,
                action: {
                    street: source.action?.street || 'PREFLOP',
                    type: source.action?.type || 'bet',
                    amount: source.action?.amount ?? null,
                    pot: source.action?.pot ?? null
                },
                notes: source.notes || ''
            };
        }

        function createCardBadgeElement(cardCode) {
            const suits = { s: '‚ô†', h: '‚ô•', d: '‚ô¶', c: '‚ô£' };
            const badge = document.createElement('span');
            badge.className = 'card-badge';
            if (!cardCode) {
                badge.classList.add('card-badge--empty');
                badge.textContent = '--';
                return badge;
            }
            const upper = cardCode.toUpperCase();
            const rank = upper.slice(0, 1);
            const suitCode = upper.slice(1, 2).toLowerCase();
            const symbol = suits[suitCode] || '';
            badge.textContent = `${rank}${symbol}`;
            if (suitCode) {
                badge.classList.add(`card-badge--${suitCode}`);
            }
            return badge;
        }

        function renderAnalysisCards() {
            if (!analysisHeroCards || !analysisBoardCards) {
                return;
            }

            const heroCards = state.heroCards.map(card => card ? card.toUpperCase() : null);
            analysisHeroCards.innerHTML = '';
            heroCards.forEach(card => {
                analysisHeroCards.appendChild(createCardBadgeElement(card));
            });
            while (analysisHeroCards.childElementCount < 2) {
                analysisHeroCards.appendChild(createCardBadgeElement(null));
            }

            const boardCards = state.board.map(card => card ? card.toUpperCase() : null);
            analysisBoardCards.innerHTML = '';
            const required = 5;
            for (let i = 0; i < required; i += 1) {
                analysisBoardCards.appendChild(createCardBadgeElement(boardCards[i] || null));
            }
        }

        function roundToMultiple(value, base = 5) {
            if (!Number.isFinite(value)) {
                return 0;
            }
            const sign = value >= 0 ? 1 : -1;
            let rounded = Math.round(Math.abs(value) / base) * base;
            if (rounded === 0 && value !== 0) {
                rounded = base;
            }
            return rounded * sign;
        }

        function formatChips(amount) {
            if (amount === null || amount === undefined || amount === '') {
                return '-';
            }
            const num = Number(amount);
            if (!Number.isFinite(num)) {
                return '-';
            }
            const rounded = roundToMultiple(num, 5);
            return `${rounded}`;
        }

        function refreshSummary() {
            const summaryLabels = translations[state.language].summary.items;
            const summaryData = [
                { key: 'pot', value: formatChips(getNumericValue('potInput')) },
                { key: 'toCall', value: formatChips(getNumericValue('toCallInput')) },
                { key: 'heroStack', value: formatChips(getNumericValue('heroStackInput')) },
                { key: 'villainStack', value: formatChips(getNumericValue('villainStackInput')) },
                { key: 'street', value: t(`streets.${state.street}`) },
                { key: 'position', value: positionLabels[state.position][state.language] },
                { key: 'numOpponents', value: `${state.numOpponents}` },
                { key: 'risk', value: `${riskSlider ? riskSlider.value : 5}/10` },
                { key: 'opponentModel', value: getOpponentSummaryText() }
            ];

            if (stageValueEl) {
                stageValueEl.textContent = t(`streets.${state.street}`);
            }

            if (riskMetricValueEl) {
                riskMetricValueEl.textContent = `${riskSlider ? riskSlider.value : 5}/10`;
            }

            renderAnalysisCards();

            if (!summaryGrid) {
                return;
            }

            summaryGrid.innerHTML = '';

            summaryData.forEach(({ key, value }) => {
                const wrapper = document.createElement('div');
                wrapper.className = 'summary-item';

                const label = document.createElement('span');
                label.textContent = summaryLabels[key] || key;

                const strong = document.createElement('strong');
                strong.textContent = value;

                wrapper.appendChild(label);
                wrapper.appendChild(strong);
                summaryGrid.appendChild(wrapper);
            });
        }

        function getOpponentSummaryText() {
            const aggressionScore = Math.round((state.opponent.aggression || 0) * 10);
            const tightnessScore = Math.round((state.opponent.tightness || 0) * 10);
            if (state.language === 'zh') {
                return `ÊøÄËøõ ${aggressionScore}/10ÔΩúËåÉÂõ¥ ${tightnessScore}/10`;
            }
            return `Agg ${aggressionScore}/10 ¬∑ Range ${tightnessScore}/10`;
        }

        function translateAction(action) {
            if (!action) {
                return '-';
            }
            const key = action.toLowerCase();
            return actionLabels[state.language][key] || action.toUpperCase();
        }

        function showRecommendation(data) {
            state.lastResult = { kind: 'recommendation', data };
            const actionText = translateAction(data.action);
            if (data.amount && data.action && data.action.toLowerCase() === 'raise' && Number(data.amount) > 0) {
                actionValue.textContent = `${actionText} ${formatChips(data.amount)}`;
            } else {
                actionValue.textContent = actionText;
            }

            if (typeof data.confidence === 'number') {
                confidenceValue.textContent = `${(data.confidence * 100).toFixed(1)}%`;
            } else {
                confidenceValue.textContent = '-';
            }

            if (typeof data.expected_value === 'number') {
                evValue.textContent = formatChips(data.expected_value);
            } else {
                evValue.textContent = '-';
            }

            resultBanner.style.display = 'grid';

            if (data.explanation) {
                explanationBox.textContent = data.explanation;
                explanationBox.style.display = 'block';
            } else {
                explanationBox.style.display = 'none';
            }

            displayFactors(data.all_factors || data.factors_used);
            renderOpponentInsights(data.opponent_profile, data.all_factors);
            refreshSummary();
        }

        function showEquityOnly(data) {
            state.lastResult = { kind: 'equity', data };
            const percent = data.win_percentage ? data.win_percentage.toFixed(1) : (data.equity ? (data.equity * 100).toFixed(1) : '-');
            actionValue.textContent = `${percent}%`;
            confidenceValue.textContent = '-';
            evValue.textContent = '-';
            resultBanner.style.display = 'grid';
            explanationBox.textContent = state.language === 'zh' ? 'ÂΩìÂâçÊâãÁâåÂØπËæìÂÖ•ËåÉÂõ¥ÁöÑËÉúÁéá' : 'Win probability versus the selected range';
            explanationBox.style.display = 'block';
            factorsGrid.innerHTML = '';
            renderOpponentInsights(data.opponent_profile || null, null);
            refreshSummary();
        }

        function showError(message) {
            if (!message) {
                errorBox.textContent = '';
                errorBox.classList.remove('active');
                return;
            }
            errorBox.textContent = message;
            errorBox.classList.add('active');
        }

        function validateBeforeRequest() {
            if (state.heroCards.filter(Boolean).length !== 2) {
                showError(t('errors.missingCards'));
                return false;
            }
            const requiredBoard = streetBoardCounts[state.street];
            if (state.board.filter(Boolean).length !== requiredBoard) {
                showError(t('errors.boardRequirement'));
                return false;
            }
            showError('');
            return true;
        }

        async function request(endpoint, payload) {
            try {
                const response = await fetch(`${API_URL}${endpoint}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    state.apiStatus = 'ok';
                    updateApiStatusLabel('ok');
                    const errorData = await response.json().catch(() => ({}));
                    const message = errorData.error || `HTTP ${response.status}`;
                    throw new Error(message);
                }

                state.apiStatus = 'ok';
                updateApiStatusLabel('ok');
                return response.json();
            } catch (error) {
                if (error instanceof TypeError || error.message === 'Failed to fetch') {
                    state.apiStatus = 'error';
                    updateApiStatusLabel('error');
                    throw new Error(getBackendUnavailableMessage());
                }
                throw error;
            }
        }

        function localizeBackendMessage(message) {
            if (state.language === 'zh') {
                if (message.includes('exactly two hero cards')) {
                    return 'Âæ∑Â∑ûÊâëÂÖãËßÑÂàôË¶ÅÊ±Ç‰Ω†ÂøÖÈ°ªÊåÅÊúâ‰∏§Âº†‰∏çÂêåÁöÑÂ∫ïÁâå„ÄÇ';
                }
                if (message.includes('Duplicate cards')) {
                    return 'Âá∫Áé∞ÈáçÂ§çÂç°ÁâåÔºåËØ∑ÈáçÊñ∞ÈÄâÊã©„ÄÇ';
                }
                if (message.includes('community cards cannot exceed five')) {
                    return 'ÂÖ¨ÂÖ±ÁâåÊúÄÂ§öÂè™ËÉΩÊúâ‰∫îÂº†„ÄÇ';
                }
                if (message.includes('requires exactly')) {
                    return 'ÂΩìÂâçÈò∂ÊÆµÁöÑÂÖ¨ÂÖ±ÁâåÊï∞Èáè‰∏çÂåπÈÖçÔºåËØ∑Ê†∏ÂØπÈò∂ÊÆµÂíåÁâåÈù¢„ÄÇ';
                }
            }
            return message;
        }

        async function handleRecommendation() {
            if (!validateBeforeRequest()) {
                return;
            }
            showLoading();
            try {
                const payload = gatherGameState();
                const data = await request('/api/get_recommendation', payload);
                showRecommendation(data);
            } catch (error) {
                showError(localizeBackendMessage(error.message));
            } finally {
                hideLoading();
            }
        }

        async function handleEquityOnly() {
            if (state.heroCards.filter(Boolean).length !== 2) {
                showError(t('errors.missingCards'));
                return;
            }
            showLoading();
            try {
                const payload = gatherGameState();
                const data = await request('/api/get_equity', {
                    hero_cards: payload.hero_cards,
                    board: payload.board,
                    villain_range: payload.villain_range,
                    num_opponents: 1,
                    iterations: 10000
                });
                showEquityOnly(data);
            } catch (error) {
                showError(localizeBackendMessage(error.message));
            } finally {
                hideLoading();
            }
        }

        function initPositionSelect() {
            Object.entries(positionLabels).forEach(([value, labels]) => {
                const option = document.createElement('option');
                option.value = value;
                option.textContent = labels[state.language];
                positionSelect.appendChild(option);
            });
            positionSelect.value = state.position;

            positionSelect.addEventListener('change', () => {
                state.position = positionSelect.value;
                refreshSummary();
            });
        }

        function initStreetOptions() {
            streetOptions.addEventListener('change', (event) => {
                if (event.target && event.target.name === 'street') {
                    const value = event.target.value;
                    streetOptions.querySelectorAll('label').forEach(label => {
                        label.classList.toggle('active', label.getAttribute('data-street') === value);
                    });
                    onStreetChange(value);
                }
            });
        }

        function initDeckAndSlots() {
            renderSlots();
            buildDeck();
        }

        function initNumericInputs() {
            ['potInput', 'toCallInput', 'heroStackInput', 'villainStackInput', 'numOpponentsInput'].forEach(id => {
                const el = document.getElementById(id);
                if (!el) {
                    return;
                }
                el.addEventListener('input', () => {
                    if (id === 'numOpponentsInput') {
                        const value = Math.max(1, Math.min(8, Math.round(Number(el.value) || 1)));
                        state.numOpponents = value;
                        el.value = value;
                    }
                    refreshSummary();
                });
            });
        }

        function initLanguageToggle() {
            langToggle.addEventListener('click', () => {
                state.language = state.language === 'en' ? 'zh' : 'en';
                translatePage();
                renderSlots();
            });
        }

        function initButtons() {
            document.getElementById('recommendButton').addEventListener('click', handleRecommendation);
            document.getElementById('equityButton').addEventListener('click', handleEquityOnly);
            document.getElementById('resetButton').addEventListener('click', resetBoardSelections);
        }

        function initRiskSlider() {
            riskSlider.addEventListener('input', () => {
                riskValue.textContent = riskSlider.value;
                refreshSummary();
            });

            riskValue.textContent = riskSlider.value;
            refreshSummary();
        }

        function initOpponentControls() {
            if (!opAggressionInput) {
                return;
            }

            const sliderConfigs = [
                { input: opAggressionInput, display: opAggressionValue, key: 'aggression' },
                { input: opTightnessInput, display: opTightnessValue, key: 'tightness' },
                { input: opBluffInput, display: opBluffValue, key: 'bluff' },
                { input: opConfidenceInput, display: opConfidenceValue, key: 'confidence' },
                { input: opTiltInput, display: opTiltValue, key: 'tilt' }
            ];

            sliderConfigs.forEach(({ input, display, key }) => {
                if (!input) {
                    return;
                }
                const apply = () => {
                    if (!opponentDraft) {
                        opponentDraft = cloneOpponentState(state.opponent);
                    }
                    const rawValue = Math.max(0, Math.min(10, Number(input.value || 0)));
                    opponentDraft[key] = rawValue / 10;
                    if (display) {
                        display.textContent = `${rawValue}/10`;
                    }
                };
                input.addEventListener('input', apply);
            });

            if (opBetPctInput) {
                opBetPctInput.addEventListener('input', () => {
                    if (!opponentDraft) {
                        opponentDraft = cloneOpponentState(state.opponent);
                    }
                    const value = Math.max(0, Math.min(400, Number(opBetPctInput.value || 0)));
                    opponentDraft.betPct = value;
                });
            }

            if (opActionStreet) {
                opActionStreet.addEventListener('change', () => {
                    if (!opponentDraft) {
                        opponentDraft = cloneOpponentState(state.opponent);
                    }
                    opponentDraft.action.street = opActionStreet.value;
                });
            }

            if (opActionType) {
                opActionType.addEventListener('change', () => {
                    if (!opponentDraft) {
                        opponentDraft = cloneOpponentState(state.opponent);
                    }
                    opponentDraft.action.type = opActionType.value;
                });
            }

            if (opActionAmount) {
                opActionAmount.addEventListener('input', () => {
                    if (!opponentDraft) {
                        opponentDraft = cloneOpponentState(state.opponent);
                    }
                    const value = parseFloat(opActionAmount.value);
                    opponentDraft.action.amount = Number.isFinite(value) ? value : null;
                });
            }

            if (opActionPot) {
                opActionPot.addEventListener('input', () => {
                    if (!opponentDraft) {
                        opponentDraft = cloneOpponentState(state.opponent);
                    }
                    const value = parseFloat(opActionPot.value);
                    opponentDraft.action.pot = Number.isFinite(value) ? value : null;
                });
            }

            if (opNotesInput) {
                opNotesInput.addEventListener('input', () => {
                    if (!opponentDraft) {
                        opponentDraft = cloneOpponentState(state.opponent);
                    }
                    opponentDraft.notes = opNotesInput.value;
                });
            }

            syncOpponentControls();
        }

        function syncOpponentControls() {
            if (!opAggressionInput) {
                return;
            }

            if (!opponentDraft) {
                opponentDraft = cloneOpponentState(state.opponent);
            }

            const sliderConfigs = [
                { input: opAggressionInput, display: opAggressionValue, key: 'aggression' },
                { input: opTightnessInput, display: opTightnessValue, key: 'tightness' },
                { input: opBluffInput, display: opBluffValue, key: 'bluff' },
                { input: opConfidenceInput, display: opConfidenceValue, key: 'confidence' },
                { input: opTiltInput, display: opTiltValue, key: 'tilt' }
            ];

            sliderConfigs.forEach(({ input, display, key }) => {
                if (!input) {
                    return;
                }
                const rawValue = Math.round((opponentDraft[key] || 0) * 10);
                input.value = rawValue;
                if (display) {
                    display.textContent = `${rawValue}/10`;
                }
            });

            if (opBetPctInput) {
                opBetPctInput.value = opponentDraft.betPct ?? 65;
            }

            if (opActionStreet) {
                opActionStreet.value = opponentDraft.action?.street || 'PREFLOP';
            }

            if (opActionType) {
                opActionType.value = opponentDraft.action?.type || 'bet';
            }

            if (opActionAmount) {
                opActionAmount.value = opponentDraft.action?.amount ?? '';
            }

            if (opActionPot) {
                opActionPot.value = opponentDraft.action?.pot ?? '';
            }

            if (opNotesInput) {
                opNotesInput.value = opponentDraft.notes || '';
            }
        }

        function initHealthCheck(options = {}) {
            const { silent = false } = options;
            state.apiStatus = 'checking';
            updateApiStatusLabel('checking');

            return fetch(`${API_URL}/health`)
                .then((response) => {
                    if (!response.ok) {
                        throw new Error('Health check failed');
                    }
                    state.apiStatus = 'ok';
                    updateApiStatusLabel('ok');
                    if (!silent) {
                        showError('');
                    }
                })
                .catch(() => {
                    state.apiStatus = 'error';
                    updateApiStatusLabel('error');
                    if (!silent) {
                        showError(getBackendUnavailableMessage());
                    }
                });
        }

        function bootstrap() {
            initApiConfig();
            initStreetOptions();
            initPositionSelect();
            initDeckAndSlots();
            initButtons();
            initNumericInputs();
            initRiskSlider();
            initOpponentControls();
            initLanguageToggle();
            translatePage();
            initHealthCheck();
        }
    </script>
</body>
</html>
